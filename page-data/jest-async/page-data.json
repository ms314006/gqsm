{"componentChunkName":"component---src-templates-post-tsx","path":"/jest-async/","webpackCompilationHash":"3e216d6caac7b3e6da75","result":{"data":{"logo":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAC4jAAAuIwF4pT92AAABEElEQVQoz6XSQUsCQRTA8d1tt4UQlAj0Jt08W0RSeDNBTLrXRdQMBEEFEUUE6WKXbl26ePADdNFv4qFP0TfY7f+2tzEknhr48ebN7nvMzK4VhqFljiAIosi6w/xAcuY2ZG4LmeuaI/XK+e3FpIAtruNm1n8GDW7Cn3GnuajgEUnkMMQpMmjiEkUc6+7L5g6X+MJG8ystKmrjAQXStI0eFuR5SN09zrE2d7jShh96Pw+4QAnvaOn9PuOMvIax7Jp8TpxhBC9uOMUnXjTPoo8JniiqEl/xpvMOsUu8JdblaohybUdSfIgGCwk9pq9NfZwYp0jxTvwsLV/5z3ewozvUI7q66FHkmr9S/Fvs+Zg7z78BWv9x1aNpq+AAAAAASUVORK5CYII=","width":400,"height":167,"src":"/static/47b2a725da5afc6280b3ee7d8fac6b1a/647de/gqsm-logo.png","srcSet":"/static/47b2a725da5afc6280b3ee7d8fac6b1a/647de/gqsm-logo.png 1x,\n/static/47b2a725da5afc6280b3ee7d8fac6b1a/59139/gqsm-logo.png 1.5x,\n/static/47b2a725da5afc6280b3ee7d8fac6b1a/af144/gqsm-logo.png 2x"}}},"markdownRemark":{"html":"<h2>前言</h2>\n<p>上一篇「<a class=\"dj by iy iz ja jb\" target=\"_blank\" rel=\"noopener\" href=\"/jest-base-tutorial/\">讓 Jest 為你的 Code 做測試-基礎用法教學</a>」中提到了如何使用 <code class=\"hm jc jd je jf b\">Jest</code> 做單元測試，但是 <code class=\"hm jc jd je jf b\">JavaScript</code> 是屬於同步執行的程式碼，這種特性會使 <code class=\"hm jc jd je jf b\">Jest</code> 在測試結果出現問題，本篇會針對這點來講解關於異步測試的方法。</p>\n<hr>\n<h2>異步測試</h2>\n<h3>測試流程</h3>\n<p>首先建立一個用 <code class=\"hm jc jd je jf b\">setTimeout</code> 的延遲模擬請求獲取資料的 <code class=\"hm jc jd je jf b\">function</code> ，獲取後再將資料傳到 <code class=\"hm jc jd je jf b\">callBack</code> 中執行。</p>\n<p>這裡將函式 <code class=\"hm jc jd je jf b\">fetchData</code> 放在 <code class=\"hm jc jd je jf b\">./func/async.js</code> 中：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//傳入一個 callBack 函數，在獲取資料時執行</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fetchData</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">callBack</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> \n        <span class=\"token function\">callBack</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getData'</span><span class=\"token punctuation\">)</span> \n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">//將該 fetchData 函式匯出</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    fetchData<span class=\"token punctuation\">:</span> fetchData\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>建立測試檔案 <code class=\"hm jc jd je jf b\">./<strong>test</strong>/async.test.js</code> ，在檔案中匯入 <code class=\"hm jc jd je jf b\">fetchData</code> ，並在 <code class=\"hm jc jd je jf b\">callBack</code> 函式內設定斷言，測試 <code class=\"hm jc jd je jf b\">fetchData</code> 回傳的資料是否符合期望值：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> async <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../funcs/async.js'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">//建立測試</span>\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test async'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">]</span>\n    <span class=\"token comment\">//callBack 會在 fetchData 取得資料後執行</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">callBack</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getData'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token comment\">//將上方的 callBack 函式傳入 fetchData 中</span>\n    async<span class=\"token punctuation\">.</span><span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span>callBack<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>完成以上設置後，便可以執行測試了，這裡使用能夠產生覆蓋率報告的測試指令，會得到以下結果：</p>\n<div><img class=\"dz t u hi ak\" src=\"https://miro.medium.com/max/2348/1*MHX0_s7j43ZOskPYi7k9sQ.png\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>&#x6E2C;&#x8A66;&#x7D50;&#x679C;&#x986F;&#x793A;&#x6B63;&#x78BA;&#xFF0C;&#x4F46;&#x8986;&#x84CB;&#x7387;&#x537B;&#x4E0D;&#x662F; 100 %</span>\n          </div></div><br>\n<p>可以看到結果是 <code class=\"hm jc jd je jf b\">PASS</code> ，也就是說 <code class=\"hm jc jd je jf b\">callBack</code> 接收到的斷言和我們期望的值相同，但是卻發現測試的覆蓋率卻不是 100 %，代表在 <code class=\"hm jc jd je jf b\">fetchData</code> 中有些地方沒有執行到，測試就已經結束了，這時可以點開 <code class=\"hm jc jd je jf b\">./coverage/Icov-report</code> 內關於 <code class=\"hm jc jd je jf b\">async.js</code> 的執行報告來看：</p>\n<div><img class=\"dz t u hi ak\" src=\"https://miro.medium.com/max/2356/1*_l_TlHzblrccb6_q-5Hwqg.png\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>&#x5728;&#x6E2C;&#x8A66;&#x6642;&#x6839;&#x672C;&#x6C92;&#x8DD1;&#x9032; callBack &#x4E2D;</span>\n          </div></div><br>\n<h3>發現問題</h3>\n<p>經過上方的操作，可以發現就算在測試中 <code class=\"hm jc jd je jf b\">JavaScript</code> 也是一如既往同步執行，不會等到 <code class=\"hm jc jd je jf b\">callBack</code> 執行，也不會到設定的斷言，整個測試就已經結束了。</p>\n<p>這裡可以將代碼改為更直接的方式測試：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> async <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../funcs/async.js'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test async'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">callBack</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//將斷言中的結果傳入空值，期望值為 'getData' 不變</span>\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getData'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    async<span class=\"token punctuation\">.</span><span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span>callBack<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>有興趣可以試試上方的測試，結果依然會是 <code class=\"hm jc jd je jf b\">PASS</code> ，因為 <code class=\"hm jc jd je jf b\">callBack</code> 函式根本就沒有執行到。</p>\n<h3>解決問題</h3>\n<p>雖然在 <code class=\"hm jc jd je jf b\">JavaScript</code> 中，處理同步問題一直不是輕鬆的事情，但是 <code class=\"hm jc jd je jf b\">Jest</code> 在執行測試的時候可以透過 <code class=\"hm jc jd je jf b\">done()</code> 來應付這個狀況。</p>\n<p>簡單來說，如果在測試裡有加入 <code class=\"hm jc jd je jf b\">done()</code> ，那只要還沒執行到 <code class=\"hm jc jd je jf b\">done()</code> 就不算結束測試，因此可以將它加入上方的程式裡：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> async <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../funcs/async.js'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">//將 done 傳入測試中</span>\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test async'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">callBack</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getData'</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">//在 callBack 函式內的斷言後加上 done</span>\n        <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    async<span class=\"token punctuation\">.</span><span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span>callBack<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>加入 <code class=\"hm jc jd je jf b\">done()</code> 後重新執行測試，就可以看到報告呈現了完美的一片綠光。</p>\n<div><img class=\"dz t u hi ak\" src=\"https://miro.medium.com/max/2308/1*TL0MzoVpZW0FAPvgG-5QAg.png\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>&#x6E2C;&#x8A66;&#x8986;&#x84CB;&#x7387;&#x5DF2;&#x9054; 100 %</span>\n          </div></div><br>\n<p>需要注意的是，如果測試中有傳入 <code class=\"hm jc jd je jf b\">done</code> 但卻未執行它，那麼該測試結果就會出現 <code class=\"hm jc jd je jf b\">FAIL</code> 失敗：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> async <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../funcs/async.js'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test async'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">callBack</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getData'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    async<span class=\"token punctuation\">.</span><span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span>callBack<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>執行測試結果如下：</p>\n<div><img class=\"dz t u hi ak\" src=\"https://miro.medium.com/max/2852/1*iJSfXFmId2Ci-_RkDAICxw.png\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>&#x6E2C;&#x8A66;&#x6642;&#x64C1;&#x6709;&#x53C3;&#x6578; done &#x537B;&#x672A;&#x57F7;&#x884C;&#xFF0C;&#x6E2C;&#x8A66;&#x6703;&#x7522;&#x751F;&#x932F;&#x8AA4;</span>\n          </div></div><br>\n<h3>使用 Promise</h3>\n<p>如果既有的程式碼已使用 <code class=\"hm jc jd je jf b\">Promise</code> 處理同步，便不必再使用 <code class=\"hm jc jd je jf b\">done</code> ，直接以 <code class=\"hm jc jd je jf b\">.then</code> 接收 <code class=\"hm jc jd je jf b\">Promise</code> 物件傳進 <code class=\"hm jc jd je jf b\">resolve</code> 的結果即可：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">promiseFetchData</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span>reject</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n        <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n            <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getData'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> \n<span class=\"token punctuation\">}</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    promiseFetchData<span class=\"token punctuation\">:</span> promiseFetchData\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> async <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../funcs/async.js'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test promise async'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//return 是必須的，否則不會執行 .then 的內容</span>\n    <span class=\"token keyword\">return</span> async<span class=\"token punctuation\">.</span><span class=\"token function\">promiseFetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n            <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getData'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>需要注意的是，在測試的 <code class=\"hm jc jd je jf b\">function</code> 中必須加上 <code class=\"hm jc jd je jf b\">return</code> ，否則測試不會跑進 <code class=\"hm jc jd je jf b\">.then</code> 中，只會在 <code class=\"hm jc jd je jf b\">Promise</code> 將結果送進 <code class=\"hm jc jd je jf b\">resolve</code> 時就結束了，另外！當 <code class=\"hm jc jd je jf b\">Promise</code> 中的結果跑進 <code class=\"hm jc jd je jf b\">reject</code> 那測試也會產生錯誤。</p>\n<p>測試結果得到 <code class=\"hm jc jd je jf b\">PASS</code> ，覆蓋率也是 100 %：</p>\n<div><img class=\"dz t u hi ak\" src=\"https://miro.medium.com/max/3676/1*ADb294uKDf2j0PmxraDOHA.png\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>&#x4F7F;&#x7528; Promise &#x6E2C;&#x8A66;&#x7684;&#x7D50;&#x679C;</span>\n          </div></div><br>\n<p>上述說明了成功的 <code class=\"hm jc jd je jf b\">resolve</code> 在測試中用 <code class=\"hm jc jd je jf b\">.then</code> 接收，而失敗的 <code class=\"hm jc jd je jf b\">reject</code> 則是使用 <code class=\"hm jc jd je jf b\">.catch</code> 處理接下來的動作，這部分和 <code class=\"hm jc jd je jf b\">Promise</code> 的操作都相同，就不再闡述，如果對 <code class=\"hm jc jd je jf b\">Promise</code> 不熟，可以參考「<a class=\"dj by iy iz ja jb\" target=\"_blank\" rel=\"noopener\" href=\"/js-promise/\">JacaScript | 從Promise開始承諾的部落格生活</a>」。</p>\n<p><code class=\"hm jc jd je jf b\">Jest</code> 在 <code class=\"hm jc jd je jf b\">expect</code> 內還另外擁有兩個內建屬性來針對 <code class=\"hm jc jd je jf b\">Promise</code> 做處理，分別為 <code class=\"hm jc jd je jf b\">resolves</code> 及 <code class=\"hm jc jd je jf b\">rejects</code> ，他們會直接捕捉 <code class=\"hm jc jd je jf b\">Promise</code> 傳進<code class=\"hm jc jd je jf b\">resolve</code> 或 <code class=\"hm jc jd je jf b\">reject</code> 的資料判斷是否符合期望值，這裡以 <code class=\"hm jc jd je jf b\">rejects</code> 作為例子：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">promiseErrorFetchData</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span>reject</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n        <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n            <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> \n<span class=\"token punctuation\">}</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    promiseErrorFetchData<span class=\"token punctuation\">:</span> promiseErrorFetchData\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>測試時，直接將 <code class=\"hm jc jd je jf b\">promiseErrorFetchData</code> 作為參數傳遞給 <code class=\"hm jc jd je jf b\">expect</code> ，並透過 <code class=\"hm jc jd je jf b\">expect</code> 的內建屬性 <code class=\"hm jc jd je jf b\">rejects</code> 取得 <code class=\"hm jc jd je jf b\">promiseErrorFetchData</code> 中 <code class=\"hm jc jd je jf b\">Promise</code> 傳進 <code class=\"hm jc jd je jf b\">reject</code> 的資料下斷言：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test rejects in promise'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//return 是必須的，否則不會等 Promise 執行到 reject 測試就結束了</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>async<span class=\"token punctuation\">.</span><span class=\"token function\">promiseErrorFetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>rejects<span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>這個方式筆者認為能夠更直覺性的使用 <code class=\"hm jc jd je jf b\">Promise</code> 的測試，得到的結果也都和上方一樣，但主要還是配合團隊使用其中一種，才不會讓測試代碼顯得雜亂，當然！個人開發也是一樣。</p>\n<hr>\n<p>本文針對異步請求在測試內產生的問題舉了幾個例子解決，但其實官網上還有提出一種使用 <code class=\"hm jc jd je jf b\">async/await</code> 的方式，不過筆者還未學習到 <code class=\"hm jc jd je jf b\">JavaScript</code> 中關於 <code class=\"hm jc jd je jf b\">async</code> 及 <code class=\"hm jc jd je jf b\">await</code> 的用法，因此怕現階段會誤導大家，就等日後使用到再回來補充文章內容。</p>\n<p>如果文章中有任何問題，或是不理解的地方，都可以留言告訴我！謝謝大家！</p>\n<p>參考文章</p>\n<ol>\n<li id=\"223c\" class=\"ik il em at im b in kg ip kh ir ki it kj iv kk ix kw kx ky\"><a href=\"https://jestjs.io/docs/en/asynchronous#async-await\" class=\"dj by iy iz ja jb\" target=\"_blank\" rel=\"noopener nofollow\">https://jestjs.io/docs/en/asynchronous#async-await</a></li>\n</ol>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"前言"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"上一篇「"},{"type":"element","tagName":"a","properties":{"className":["dj","by","iy","iz","ja","jb"],"target":"_blank","rel":["noopener"],"href":"/jest-base-tutorial/"},"children":[{"type":"text","value":"讓 Jest 為你的 Code 做測試-基礎用法教學"}]},{"type":"text","value":"」中提到了如何使用 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"Jest"}]},{"type":"text","value":" 做單元測試，但是 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"JavaScript"}]},{"type":"text","value":" 是屬於同步執行的程式碼，這種特性會使 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"Jest"}]},{"type":"text","value":" 在測試結果出現問題，本篇會針對這點來講解關於異步測試的方法。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"異步測試"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"測試流程"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"首先建立一個用 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"setTimeout"}]},{"type":"text","value":" 的延遲模擬請求獲取資料的 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"function"}]},{"type":"text","value":" ，獲取後再將資料傳到 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"callBack"}]},{"type":"text","value":" 中執行。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"這裡將函式 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"fetchData"}]},{"type":"text","value":" 放在 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"./func/async.js"}]},{"type":"text","value":" 中："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//傳入一個 callBack 函數，在獲取資料時執行"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"fetchData"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"callBack"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setTimeout"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" \n        "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"callBack"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getData'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" \n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3000"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//將該 fetchData 函式匯出"}]},{"type":"text","value":"\nmodule"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"exports "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    fetchData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" fetchData\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"建立測試檔案 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"./"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"test"}]},{"type":"text","value":"/async.test.js"}]},{"type":"text","value":" ，在檔案中匯入 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"fetchData"}]},{"type":"text","value":" ，並在 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"callBack"}]},{"type":"text","value":" 函式內設定斷言，測試 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"fetchData"}]},{"type":"text","value":" 回傳的資料是否符合期望值："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"let"}]},{"type":"text","value":" async "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"require"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'../funcs/async.js'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//建立測試"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"test"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'test async'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//callBack 會在 fetchData 取得資料後執行"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"callBack"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"data"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"expect"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"data"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getData'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n    \n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//將上方的 callBack 函式傳入 fetchData 中"}]},{"type":"text","value":"\n    async"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"fetchData"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"callBack"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"完成以上設置後，便可以執行測試了，這裡使用能夠產生覆蓋率報告的測試指令，會得到以下結果："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["dz","t","u","hi","ak"],"src":"https://miro.medium.com/max/2348/1*MHX0_s7j43ZOskPYi7k9sQ.png","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"測試結果顯示正確，但覆蓋率卻不是 100 %"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"可以看到結果是 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"PASS"}]},{"type":"text","value":" ，也就是說 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"callBack"}]},{"type":"text","value":" 接收到的斷言和我們期望的值相同，但是卻發現測試的覆蓋率卻不是 100 %，代表在 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"fetchData"}]},{"type":"text","value":" 中有些地方沒有執行到，測試就已經結束了，這時可以點開 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"./coverage/Icov-report"}]},{"type":"text","value":" 內關於 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"async.js"}]},{"type":"text","value":" 的執行報告來看："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["dz","t","u","hi","ak"],"src":"https://miro.medium.com/max/2356/1*_l_TlHzblrccb6_q-5Hwqg.png","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"在測試時根本沒跑進 callBack 中"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"發現問題"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"經過上方的操作，可以發現就算在測試中 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"JavaScript"}]},{"type":"text","value":" 也是一如既往同步執行，不會等到 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"callBack"}]},{"type":"text","value":" 執行，也不會到設定的斷言，整個測試就已經結束了。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"這裡可以將代碼改為更直接的方式測試："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"let"}]},{"type":"text","value":" async "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"require"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'../funcs/async.js'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"test"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'test async'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"callBack"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"data"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//將斷言中的結果傳入空值，期望值為 'getData' 不變"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"expect"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"''"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getData'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n    async"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"fetchData"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"callBack"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"有興趣可以試試上方的測試，結果依然會是 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"PASS"}]},{"type":"text","value":" ，因為 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"callBack"}]},{"type":"text","value":" 函式根本就沒有執行到。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"解決問題"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"雖然在 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"JavaScript"}]},{"type":"text","value":" 中，處理同步問題一直不是輕鬆的事情，但是 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"Jest"}]},{"type":"text","value":" 在執行測試的時候可以透過 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"done()"}]},{"type":"text","value":" 來應付這個狀況。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"簡單來說，如果在測試裡有加入 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"done()"}]},{"type":"text","value":" ，那只要還沒執行到 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"done()"}]},{"type":"text","value":" 就不算結束測試，因此可以將它加入上方的程式裡："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"let"}]},{"type":"text","value":" async "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"require"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'../funcs/async.js'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//將 done 傳入測試中"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"test"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'test async'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"done"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"callBack"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"data"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"expect"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"data"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getData'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//在 callBack 函式內的斷言後加上 done"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"done"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n    async"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"fetchData"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"callBack"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"加入 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"done()"}]},{"type":"text","value":" 後重新執行測試，就可以看到報告呈現了完美的一片綠光。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["dz","t","u","hi","ak"],"src":"https://miro.medium.com/max/2308/1*TL0MzoVpZW0FAPvgG-5QAg.png","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"測試覆蓋率已達 100 %"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"需要注意的是，如果測試中有傳入 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"done"}]},{"type":"text","value":" 但卻未執行它，那麼該測試結果就會出現 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"FAIL"}]},{"type":"text","value":" 失敗："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"let"}]},{"type":"text","value":" async "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"require"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'../funcs/async.js'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"test"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'test async'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"done"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"callBack"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"data"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"expect"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"data"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getData'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n    async"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"fetchData"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"callBack"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"執行測試結果如下："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["dz","t","u","hi","ak"],"src":"https://miro.medium.com/max/2852/1*iJSfXFmId2Ci-_RkDAICxw.png","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"測試時擁有參數 done 卻未執行，測試會產生錯誤"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"使用 Promise"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果既有的程式碼已使用 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":" 處理同步，便不必再使用 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"done"}]},{"type":"text","value":" ，直接以 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":".then"}]},{"type":"text","value":" 接收 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":" 物件傳進 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"resolve"}]},{"type":"text","value":" 的結果即可："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"promiseFetchData"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"resolve"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"reject"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setTimeout"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getData'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3000"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" \n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\nmodule"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"exports "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    promiseFetchData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" promiseFetchData\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"let"}]},{"type":"text","value":" async "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"require"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'../funcs/async.js'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"test"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'test promise async'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//return 是必須的，否則不會執行 .then 的內容"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" async"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"promiseFetchData"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"then"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"data"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"expect"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"data"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getData'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"需要注意的是，在測試的 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"function"}]},{"type":"text","value":" 中必須加上 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" ，否則測試不會跑進 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":".then"}]},{"type":"text","value":" 中，只會在 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":" 將結果送進 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"resolve"}]},{"type":"text","value":" 時就結束了，另外！當 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":" 中的結果跑進 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"reject"}]},{"type":"text","value":" 那測試也會產生錯誤。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"測試結果得到 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"PASS"}]},{"type":"text","value":" ，覆蓋率也是 100 %："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["dz","t","u","hi","ak"],"src":"https://miro.medium.com/max/3676/1*ADb294uKDf2j0PmxraDOHA.png","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"使用 Promise 測試的結果"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"上述說明了成功的 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"resolve"}]},{"type":"text","value":" 在測試中用 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":".then"}]},{"type":"text","value":" 接收，而失敗的 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"reject"}]},{"type":"text","value":" 則是使用 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":".catch"}]},{"type":"text","value":" 處理接下來的動作，這部分和 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":" 的操作都相同，就不再闡述，如果對 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":" 不熟，可以參考「"},{"type":"element","tagName":"a","properties":{"className":["dj","by","iy","iz","ja","jb"],"target":"_blank","rel":["noopener"],"href":"/js-promise/"},"children":[{"type":"text","value":"JacaScript | 從Promise開始承諾的部落格生活"}]},{"type":"text","value":"」。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"Jest"}]},{"type":"text","value":" 在 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"expect"}]},{"type":"text","value":" 內還另外擁有兩個內建屬性來針對 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":" 做處理，分別為 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"resolves"}]},{"type":"text","value":" 及 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"rejects"}]},{"type":"text","value":" ，他們會直接捕捉 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":" 傳進"},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"resolve"}]},{"type":"text","value":" 或 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"reject"}]},{"type":"text","value":" 的資料判斷是否符合期望值，這裡以 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"rejects"}]},{"type":"text","value":" 作為例子："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"promiseErrorFetchData"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"resolve"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"reject"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setTimeout"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"reject"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'error'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3000"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" \n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\nmodule"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"exports "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    promiseErrorFetchData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" promiseErrorFetchData\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"測試時，直接將 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"promiseErrorFetchData"}]},{"type":"text","value":" 作為參數傳遞給 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"expect"}]},{"type":"text","value":" ，並透過 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"expect"}]},{"type":"text","value":" 的內建屬性 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"rejects"}]},{"type":"text","value":" 取得 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"promiseErrorFetchData"}]},{"type":"text","value":" 中 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":" 傳進 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"reject"}]},{"type":"text","value":" 的資料下斷言："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"test"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'test rejects in promise'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//return 是必須的，否則不會等 Promise 執行到 reject 測試就結束了"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"expect"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"async"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"promiseErrorFetchData"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"rejects"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"toBe"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'error'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"這個方式筆者認為能夠更直覺性的使用 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":" 的測試，得到的結果也都和上方一樣，但主要還是配合團隊使用其中一種，才不會讓測試代碼顯得雜亂，當然！個人開發也是一樣。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"本文針對異步請求在測試內產生的問題舉了幾個例子解決，但其實官網上還有提出一種使用 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"async/await"}]},{"type":"text","value":" 的方式，不過筆者還未學習到 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"JavaScript"}]},{"type":"text","value":" 中關於 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"async"}]},{"type":"text","value":" 及 "},{"type":"element","tagName":"code","properties":{"className":["hm","jc","jd","je","jf","b"]},"children":[{"type":"text","value":"await"}]},{"type":"text","value":" 的用法，因此怕現階段會誤導大家，就等日後使用到再回來補充文章內容。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果文章中有任何問題，或是不理解的地方，都可以留言告訴我！謝謝大家！"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"參考文章"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"id":"223c","className":["ik","il","em","at","im","b","in","kg","ip","kh","ir","ki","it","kj","iv","kk","ix","kw","kx","ky"]},"children":[{"type":"element","tagName":"a","properties":{"href":"https://jestjs.io/docs/en/asynchronous#async-await","className":["dj","by","iy","iz","ja","jb"],"target":"_blank","rel":["noopener","nofollow"]},"children":[{"type":"text","value":"https://jestjs.io/docs/en/asynchronous#async-await"}]}]},{"type":"text","value":"\n"}]}],"data":{"quirksMode":false}},"excerpt":"前言 上一篇「讓 Jest 為你的 Code 做測試-基礎用法教學」中提到了如何使用 Jest 做單元測試，但是 JavaScript 是屬於同步執行的程式碼，這種特性會使 Jest…","timeToRead":3,"frontmatter":{"title":"Jest | 跨越同步執行的 Jest 測試","userDate":"27 March 2019","date":"2019-03-27T00:06:20.149Z","tags":["Unit Testing","JavaScript","Jest"],"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHk1CzAf//EABYQAQEBAAAAAAAAAAAAAAAAAAECIP/aAAgBAQABBQIFWKDH/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGBAAAgMAAAAAAAAAAAAAAAAAAAERICH/2gAIAQEABj8Cwlqv/8QAGRAAAgMBAAAAAAAAAAAAAAAAAREAIDFR/9oACAEBAAE/IVrUYiB2v//aAAwDAQACAAMAAAAQh9//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAEAAgMBAAAAAAAAAAAAAAABETEAEIFR/9oACAEBAAE/EIFTCeYVV4hHtaFKUxVtXuv/2Q==","aspectRatio":1.4814814814814814,"src":"/static/61b2001ca7ff66bffe5604dc0c52016d/5a4bd/Jest.jpg","srcSet":"/static/61b2001ca7ff66bffe5604dc0c52016d/f8f18/Jest.jpg 930w,\n/static/61b2001ca7ff66bffe5604dc0c52016d/5a4bd/Jest.jpg 1840w","sizes":"(max-width: 1840px) 100vw, 1840px"}}},"author":{"id":"GQSM","bio":"Enjoy life enjoy coding!","avatar":{"children":[{"__typename":"ImageSharp","fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAC4jAAAuIwF4pT92AAACIElEQVQ4y5WTz2saQRTHd3Y3/mrxV6NbsYoIUmtMDkkrXoVgvRQUVMiteLGQ/6G9KKVC0d5CG0/NxRx6kRZ6aC8JND0KOcdzKLTgyUTd6XvL2zCUVqcDX77uzLyPb96bURRhdDodyweDAVP+Mjjnlo9GI0V69Pt9RsG36/X6i1wud9xoNPZt2Hg8locNh8Ob34VC4aPD4UAK93q9vFKpvKYl1YavHNVqVUVvtVqPwuEwRl2rqnqF0Hg8/nM6nRq43u12mRQQjmgB2+32Q8MwELjQNG2BwEQicTmZTCxgr9eTA9JRrM3FYvGD0+nEiSufz8fL5XKPtmnSR7ZhMJyBQOAkk8nwbDY7S6fT3O12f4f5e3/skwa+w4RBM/I5+SHIIwtVyfegbhyaMYeszFQqZcKcqes6pwY9kz7vt7MztPM76+s8Go3OSqUSh0aZeORgMHgdCoUwy88ejycok6Wd4fNkMsmhEYtarWY2m00TwKbf7zcjkQgC69AsrKVbOtN8Pn+ENQPADDKcx2Kxucvl4ts7O29wHS58GCyxMkuokW7dC03bZ4xZ91BsCryYXYvA2BrYFshYlZxOfoAACPwF8PcC+CUoCnoA2sQXKpRq6bX5RIC3oFugL/R9tCTmnwtY7AvQJchPc/cJ+FVoIJO91Hcp+Cl9r5G/Av0Quit9sZ+AToUgMfNzaoayqnbiP25TwcUg2x+DNv7nPbMlxZYC/AYn5p1FkAm0lwAAAABJRU5ErkJggg==","width":400,"height":402,"src":"/static/bca487154c11d830750d2707c9e6d3e5/4e842/gqsm.png","srcSet":"/static/bca487154c11d830750d2707c9e6d3e5/4e842/gqsm.png 1x,\n/static/bca487154c11d830750d2707c9e6d3e5/fca9c/gqsm.png 1.5x,\n/static/bca487154c11d830750d2707c9e6d3e5/94286/gqsm.png 2x"}}]}}}},"relatedPosts":{"totalCount":5,"edges":[{"node":{"id":"f323d4ef-6d2d-5868-b18d-a8fec5a31c9f","timeToRead":4,"excerpt":"Hello guys! I am Clark! I am going to sharing how to write a unit test for custom hooks! Custom Hooks Before we write the first unit test…","frontmatter":{"title":"React | Write a unit test for custom hooks in ten minutes"},"fields":{"slug":"/write-a-unit-test-for-custom-hooks-in-ten-minutes/"}}},{"node":{"id":"76d1d3df-5eff-5701-99ac-48416f74cadd","timeToRead":3,"excerpt":"前言 上一篇「讓 Jest 為你的 Code 做測試-基礎用法教學」中提到了如何使用 Jest 做單元測試，但是 JavaScript 是屬於同步執行的程式碼，這種特性會使 Jest…","frontmatter":{"title":"Jest | 跨越同步執行的 Jest 測試"},"fields":{"slug":"/jest-async/"}}},{"node":{"id":"be1e9bbe-dde5-5bf5-aa29-1ca6d4e057d7","timeToRead":4,"excerpt":"前言 關於 describe ，在進行測試時其實是很基本的分類，但是因為 describe 牽扯到了作用域，而在作用域內的 beforeAll 和 afterAll 等 Function 又和 async 異步測試有關，所以本篇文章的內容可能會需要先了解「Unit Test…","frontmatter":{"title":"Jest | 替測試設置分類（describe）及作用域（scoping）"},"fields":{"slug":"/jest-describe-and-scoping/"}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/jest-async/","prev":{"excerpt":"前言 關於 describe ，在進行測試時其實是很基本的分類，但是因為 describe 牽扯到了作用域，而在作用域內的 beforeAll 和 afterAll 等 Function 又和 async 異步測試有關，所以本篇文章的內容可能會需要先了解「Unit Test…","timeToRead":4,"frontmatter":{"title":"Jest | 替測試設置分類（describe）及作用域（scoping）","tags":["Unit Testing","JavaScript","Jest"],"date":"2019-03-26T00:05:48.149Z","draft":false,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.4814814814814814,"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHk1CzAf//EABYQAQEBAAAAAAAAAAAAAAAAAAECIP/aAAgBAQABBQIFWKDH/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGBAAAgMAAAAAAAAAAAAAAAAAAAERICH/2gAIAQEABj8Cwlqv/8QAGRAAAgMBAAAAAAAAAAAAAAAAAREAIDFR/9oACAEBAAE/IVrUYiB2v//aAAwDAQACAAMAAAAQh9//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAEAAgMBAAAAAAAAAAAAAAABETEAEIFR/9oACAEBAAE/EIFTCeYVV4hHtaFKUxVtXuv/2Q==","sizes":"(max-width: 1840px) 100vw, 1840px","src":"/static/61b2001ca7ff66bffe5604dc0c52016d/5a4bd/Jest.jpg","srcSet":"/static/61b2001ca7ff66bffe5604dc0c52016d/f8f18/Jest.jpg 930w,\n/static/61b2001ca7ff66bffe5604dc0c52016d/5a4bd/Jest.jpg 1840w"}}},"author":{"id":"GQSM","bio":"Enjoy life enjoy coding!","avatar":{"children":[{"fixed":{"src":"/static/bca487154c11d830750d2707c9e6d3e5/4e842/gqsm.png"}}]}}},"fields":{"layout":"post","slug":"/jest-describe-and-scoping/"}},"next":{"excerpt":"前言 Hi ！大家好，雖然之前有使用 Enzyme 講解如何搭配 Jest 對 React 的Component 做測試，但是幾個禮拜前偶然在某個討論串中看到有大神推薦另一套測試 Component 的套件 react-testing-library ，功能和 Enzyme…","timeToRead":7,"frontmatter":{"title":"Jest | 再一次測試你的 Component-feat.react-testing-library 基本用法","tags":["Unit Testing","React Testing Library","React","JavaScript","Jest"],"date":"2019-06-16T07:12:09.000Z","draft":false,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.8755760368663594,"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAByZ1FjEH/xAAYEAACAwAAAAAAAAAAAAAAAAAAEQESIP/aAAgBAQABBQKEUef/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAXEAADAQAAAAAAAAAAAAAAAAAAICEi/9oACAEBAAY/AqZq/wD/xAAaEAACAgMAAAAAAAAAAAAAAAABEQAgYYGh/9oACAEBAAE/IcjUYAW4r//aAAwDAQACAAMAAAAQdN//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAcEAACAQUBAAAAAAAAAAAAAAABERAAITFBUcH/2gAIAQEAAT8QAiXAaR0L2B5XqUOR/9k=","sizes":"(max-width: 2442px) 100vw, 2442px","src":"/static/378c08d8e4c300d730361efd1b7e91c1/8f13c/react%26jest.jpg","srcSet":"/static/378c08d8e4c300d730361efd1b7e91c1/f8f18/react%26jest.jpg 930w,\n/static/378c08d8e4c300d730361efd1b7e91c1/0e6ff/react%26jest.jpg 1860w,\n/static/378c08d8e4c300d730361efd1b7e91c1/8f13c/react%26jest.jpg 2442w"}}},"author":{"id":"GQSM","bio":"Enjoy life enjoy coding!","avatar":{"children":[{"fixed":{"src":"/static/bca487154c11d830750d2707c9e6d3e5/4e842/gqsm.png"}}]}}},"fields":{"layout":"post","slug":"/again-test-your-component/"}},"primaryTag":"Unit Testing"}}}