{"componentChunkName":"component---src-templates-post-tsx","path":"/js-websocket/","webpackCompilationHash":"3e216d6caac7b3e6da75","result":{"data":{"logo":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAC4jAAAuIwF4pT92AAABEElEQVQoz6XSQUsCQRTA8d1tt4UQlAj0Jt08W0RSeDNBTLrXRdQMBEEFEUUE6WKXbl26ePADdNFv4qFP0TfY7f+2tzEknhr48ebN7nvMzK4VhqFljiAIosi6w/xAcuY2ZG4LmeuaI/XK+e3FpIAtruNm1n8GDW7Cn3GnuajgEUnkMMQpMmjiEkUc6+7L5g6X+MJG8ystKmrjAQXStI0eFuR5SN09zrE2d7jShh96Pw+4QAnvaOn9PuOMvIax7Jp8TpxhBC9uOMUnXjTPoo8JniiqEl/xpvMOsUu8JdblaohybUdSfIgGCwk9pq9NfZwYp0jxTvwsLV/5z3ewozvUI7q66FHkmr9S/Fvs+Zg7z78BWv9x1aNpq+AAAAAASUVORK5CYII=","width":400,"height":167,"src":"/static/47b2a725da5afc6280b3ee7d8fac6b1a/647de/gqsm-logo.png","srcSet":"/static/47b2a725da5afc6280b3ee7d8fac6b1a/647de/gqsm-logo.png 1x,\n/static/47b2a725da5afc6280b3ee7d8fac6b1a/59139/gqsm-logo.png 1.5x,\n/static/47b2a725da5afc6280b3ee7d8fac6b1a/af144/gqsm-logo.png 2x"}}},"markdownRemark":{"html":"<h2>前言</h2>\n<p>最近因為工作的關係接觸到 <code class=\"hm hn ho hp hq b\">WebSocket</code> ， <code class=\"hm hn ho hp hq b\">WebSocket</code> 是網路協定的一種， Client 可以透過此協定與 Server 做溝通，而他和一般 <code class=\"hm hn ho hp hq b\">http</code> 或 <code class=\"hm hn ho hp hq b\">https</code> 不同的是， <code class=\"hm hn ho hp hq b\">WebSocket</code> 協定只需透過一次連結便能保持連線，不必再透過一直發送 <code class=\"hm hn ho hp hq b\">Request</code> 來與 Server 互動！</p>\n<hr>\n<h2>WebSocket</h2>\n<p>如前言所說， <code class=\"hm hn ho hp hq b\">WebSocket</code> 只需開啟連結便能和 Server 做溝通，且 <code class=\"hm hn ho hp hq b\">Websocket</code> 傳送資料的方式是雙向的， Client 端可以像 <code class=\"hm hn ho hp hq b\">Ajax</code> 一樣做請求， Server 端也能主動發送 Client 所需要的資料。</p>\n<p>一般的 <code class=\"hm hn ho hp hq b\">WebSocket</code> 請求網址會長這個樣子：</p>\n<pre><span id=\"eaa9\" class=\"is gm em at hq b fh it iu r iv\">ws://example.com</span><span id=\"7253\" class=\"is gm em at hq b fh iw ix iy iz ja iu r iv\">//經過 <!-- -->SSL<!-- --> 加密後，前方的 <!-- -->ws<!-- --> 會變成 <!-- -->wss<!-- --> <br>wss://example.com</span></pre>\n<br />\n### Server 端 - 搭建 WebSocket 環境\n<p><code class=\"hm hn ho hp hq b\">WebSocket</code> 的 Server 部分，本文會以 <code class=\"hm hn ho hp hq b\">Node.js</code> 建置，如果電腦上還沒有安裝 <code class=\"hm hn ho hp hq b\">Node.js</code> 可以先參考「<a href=\"https://ithelp.ithome.com.tw/articles/10199058\" class=\"dj by jm jn jo jp\" target=\"_blank\" rel=\"noopener nofollow\">[筆記][node.js]第一次建置node.js開發環境和安裝npm就上手！</a>」。</p>\n<p>處理好安裝環境後還需要在下載兩個套件，分別是用來開發 Web 框架的 <code class=\"hm hn ho hp hq b\">express</code> 和負責處理 <code class=\"hm hn ho hp hq b\">WebSocket</code> 協定的 <code class=\"hm hn ho hp hq b\">ws</code> ：</p>\n<pre><span id=\"ca26\" class=\"is gm em at hq b fh it iu r iv\">npm install express<br>npm install ws</span></pre>\n<br />\n<p>安裝完後可以到專案中的 <code class=\"hm hn ho hp hq b\">package.json</code> 中確認是否成功：</p>\n<div><img class=\"dz t u jy ak\" src=\"https://miro.medium.com/max/2108/1*EgbqxHT8iSGFbikO5oRVSg.png\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>&#x4E0B;&#x8F09;&#x5B8C;&#x5F8C;&#x7684;&#x5957;&#x4EF6;&#x6703;&#x88AB;&#x8A18;&#x9304;&#x5230; package.json &#x4E2D;</span>\n          </div></div><br>\n<p>接著在專案裡新增一個 JavaScript 檔案 <code class=\"hm hn ho hp hq b\">server.js</code> 當作專案的進入點：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//import express 和 ws 套件</span>\n<span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> SocketServer <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ws'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Server\n\n<span class=\"token comment\">//指定開啟的 port</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> <span class=\"token number\">3000</span>\n\n<span class=\"token comment\">//創建 express 的物件，並綁定及監聽 3000 port ，且設定開啟後在 console 中提示</span>\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Listening on </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">PORT</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">//將 express 交給 SocketServer 開啟 WebSocket 的服務</span>\n<span class=\"token keyword\">const</span> wss <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SocketServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> server <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">//當 WebSocket 從外部連結時執行</span>\nwss<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'connection'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">ws</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">//連結時執行此 console 提示</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Client connected'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">//當 WebSocket 的連線關閉時執行</span>\n    ws<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'close'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Close connected'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>沒問題後便可以輸入以下指令執行 <code class=\"hm hn ho hp hq b\">server.js</code> ：</p>\n<pre><span id=\"6c86\" class=\"is gm em at hq b fh it iu r iv\">node server.js</span></pre>\n<br />\n<p>當本機 Server 的指定 <code class=\"hm hn ho hp hq b\">Port</code> 被打開時，會先執行我們監聽指定的事件：</p>\n<div><img class=\"dz t u jy ak\" src=\"https://miro.medium.com/max/1756/1*VAiVKJFcfHjAIll0WDRCxg.png\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>&#x958B;&#x555F;&#x6210;&#x529F;&#x5F8C;&#x6703;&#x5728; console &#x4E2D;&#x6253;&#x5370;&#x63D0;&#x793A;</span>\n          </div></div><br>\n<h3>Client 端 - 連接 WebSocket Server</h3>\n<p>Server 端處理完後，就換到 Client 端來連結剛剛開啟的 <code class=\"hm hn ho hp hq b\">WebSocket</code> 服務，這裡另外建一個專案，在專案裡只需一個 <code class=\"hm hn ho hp hq b\">index.html</code> 及 <code class=\"hm hn ho hp hq b\">index.js</code> ：</p>\n<p><code class=\"hm hn ho hp hq b\">index.html</code> 的部分先簡單處理，只需引用 <code class=\"hm hn ho hp hq b\">index.js</code> 就可以了：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">'</span>./index.js<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><code class=\"hm hn ho hp hq b\">index.js</code> 的部分會用來處理與 <code class=\"hm hn ho hp hq b\">WebSocket</code> 的連結：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//使用 WebSocket 的網址向 Server 開啟連結</span>\n<span class=\"token keyword\">let</span> ws <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WebSocket</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ws://localhost:3000'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">//開啟後執行的動作，指定一個 function 會在連結 WebSocket 後執行</span>\nws<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onopen</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'open connection'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">//關閉後執行的動作，指定一個 function 會在連結中斷後執行</span>\nws<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onclose</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'close connection'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>上方的 <code class=\"hm hn ho hp hq b\">url</code> 為剛剛使用 <code class=\"hm hn ho hp hq b\">node.js</code> 在本機上執行的 Server ，另外的 <code class=\"hm hn ho hp hq b\">onopen</code> 及 <code class=\"hm hn ho hp hq b\">onclose</code> 分別為他們指定一個 <code class=\"hm hn ho hp hq b\">Function</code> ，在開啟和關閉連線時執行，執行結果：</p>\n<div><img class=\"dz t u jy ak\" src=\"https://miro.medium.com/max/3324/1*8CvZuLeH3jKwJ8_7gc8sHQ.png\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>&#x958B;&#x555F;&#x9023;&#x7D50;&#x5F8C;&#x6703;&#x57F7;&#x884C; onopen &#x7684;&#x4E8B;&#x4EF6;</span>\n          </div></div><br>\n<p>執行結果中可以看到 <code class=\"hm hn ho hp hq b\">onopen</code> 中在 <code class=\"hm hn ho hp hq b\">console</code> 打印的提示，除此之外，也可以從剛剛執行 Server 的地方觀察開啟連結後的訊息：</p>\n<div><img class=\"dz t u jy ak\" src=\"https://miro.medium.com/max/1772/1*y6Ivv4bi2kjIws-GxmTVYQ.png\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>&#x5728; Server &#x4E0A;&#x57F7;&#x884C;&#x6642;&#x8A18;&#x9304;&#x7684;&#x8A0A;&#x606F;</span>\n          </div></div><br>\n<p>上方也列出 <code class=\"hm hn ho hp hq b\">WebSocket</code> 的物件有哪些屬性，比較重要的還有 <code class=\"hm hn ho hp hq b\">onmessage</code> ， Client 就是靠它在接收由 Server 發送的資料，但在提到它之前，得先回到 Server 了解如何和 Client 做溝通。</p>\n<h3>回到 Server 端 - 處理接收發送訊息</h3>\n<p>提到溝通，過程一定是有來有往，在開啟 <code class=\"hm hn ho hp hq b\">WebSocket</code> 後， Server 端會使用 <code class=\"hm hn ho hp hq b\">send</code> 發送訊息，接收則是如同在 <code class=\"hm hn ho hp hq b\">connection</code> 內監聽 <code class=\"hm hn ho hp hq b\">close</code> 一樣，只是換成對 <code class=\"hm hn ho hp hq b\">message</code> 設定監聽，並接收一個參數 <code class=\"hm hn ho hp hq b\">data</code> ，捕獲 Client 端發送的訊息：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">wss<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'connection'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">ws</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Client connected'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">//對 message 設定監聽，接收從 Client 發送的訊息</span>\n    ws<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//data 為 Client 發送的訊息，現在將訊息原封不動發送出去</span>\n        ws<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    ws<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'close'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Close connected'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>回到 Client 端 - 處理接收發送訊息</h3>\n<p>剛剛處理完 Server ，要換回 Client 端使用 <code class=\"hm hn ho hp hq b\">onmessage</code> 處理接收及 <code class=\"hm hn ho hp hq b\">send</code> 送出訊息：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> ws <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WebSocket</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ws://localhost:3000'</span><span class=\"token punctuation\">)</span>\n\nws<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onopen</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'open connection'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nws<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onclose</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'close connection'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">//接收 Server 發送的訊息</span>\nws<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onmessage</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"hm hn ho hp hq b\">onmessage</code> 指定的函式中多了一個參數 <code class=\"hm hn ho hp hq b\">event</code> ，裡面會有這次溝通的詳細訊息，從 Server 回傳的資料會在 <code class=\"hm hn ho hp hq b\">event</code> 的 <code class=\"hm hn ho hp hq b\">data</code> 屬性中。</p>\n<p>但是上方的程式碼還沒有增加在 Client 中發送訊息的 <code class=\"hm hn ho hp hq b\">send</code> ，因此下方在連接到 <code class=\"hm hn ho hp hq b\">WebSocket</code> 後直接在 <code class=\"hm hn ho hp hq b\">console</code> 中發送，並確認回傳訊息：</p>\n<div><img class=\"dz t u jy ak\" src=\"https://miro.medium.com/max/3832/1*oL40RiJz591Lbn4vrSBOHg.png\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>Server &#x63A5;&#x6536; Client &#x767C;&#x9001;&#x7684;&#x8A0A;&#x606F;&#x5F8C;&#x518D;&#x56DE;&#x50B3;</span>\n          </div></div><br>\n<p>不過上面看起來還是以 Client 做 <code class=\"hm hn ho hp hq b\">send</code> 發送訊息給 Server 處理過才得到回傳資料，該怎麼從 Server 上直接發送呢？很簡單，只需要透過 <code class=\"hm hn ho hp hq b\">setInterval</code> 就能讓 Server 在固定時間發送資料給 Client ，例如下方的例子：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">wss<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'connection'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">ws</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Client connected'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">//固定送最新時間給 Client</span>\n    <span class=\"token keyword\">const</span> sendNowTime <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n        ws<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n\n    ws<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        ws<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    ws<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'close'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//連線中斷時停止 setInterval</span>\n        <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>sendNowTime<span class=\"token punctuation\">)</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Close connected'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Client 連結後的結果如下：</p>\n<div><img class=\"dz t u jy ak\" src=\"https://miro.medium.com/max/2076/1*AHKxAKEo8YuDePJjzDNtmQ.png\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>&#x4E0D;&#x65B7;&#x63A5;&#x6536; Server &#x4E3B;&#x52D5;&#x50B3;&#x905E;&#x7684;&#x8A0A;&#x606F;</span>\n          </div></div><br>\n<h3>最後一次回到 Server - 多人連線</h3>\n<p>通常 <code class=\"hm hn ho hp hq b\">WebSocket</code> 都會運用在聊天室，但是就剛剛的使用方式來說，今天 ClientA 和 ClientB 都連結同一個 Server ，而他們各自在 Client 使用 <code class=\"hm hn ho hp hq b\">send</code> 發送資料給 Server ， 在這個情況下 Server 只會依據兩個 Client 各自發送的內容，再分別回傳給 ClientA 和 ClientB ，並無法讓 ClientB 能夠在 ClientA 發送訊息時也收到回傳的資料。</p>\n<p>例如以下例子，用兩個視窗開啟 Client 並各自發送請求：</p>\n<div><img class=\"dz t u jy ak\" src=\"https://miro.medium.com/max/1276/1*ZIy6Qp5D3qkUWhpstPdKTg.gif\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>&#x5BA2;&#x6236;&#x7AEF;&#x7121;&#x6CD5;&#x5171;&#x4EAB; Server &#x767C;&#x9001;&#x7684;&#x8A0A;&#x606F;</span>\n          </div></div><br>\n<p>那該怎麼像廣播一樣，當我在某一個 Client 發送訊息時，讓 Server 告知所有其他同時連接中的 Client 都知道我對 Server 發送這個訊息，也同時接收到 Server 回傳的資料呢？</p>\n<p>答案就在一開始下載的套件 <code class=\"hm hn ho hp hq b\">ws</code> 中，它可以使用 <code class=\"hm hn ho hp hq b\">clients</code> 找出當前所有連結中的 Client 資訊，並透過迴圈將訊息發送至每一個 Client 中：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">wss<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'connection'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">ws</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Client connected'</span><span class=\"token punctuation\">)</span>\n\n    ws<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//取得所有連接中的 client</span>\n        <span class=\"token keyword\">let</span> clients <span class=\"token operator\">=</span> wss<span class=\"token punctuation\">.</span>clients\n\n        <span class=\"token comment\">//做迴圈，發送訊息至每個 client</span>\n        clients<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">client</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            client<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    ws<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'close'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Close connected'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>這麼一來，不論是哪個 Client 端發送訊息， Server 都會將訊息回覆給所有連接中的 Client ：</p>\n<div><img class=\"dz t u jy ak\" src=\"https://miro.medium.com/max/1276/1*9ETT853cZxzHKDcBfBCyqA.gif\" role=\"presentation\"></div><br>\n<h3>補充內容</h3>\n<p>雖然在 <code class=\"hm hn ho hp hq b\">WebSocket</code> 的協定上 Client 和 Server 不需再通過 <code class=\"hm hn ho hp hq b\">Request</code> ，因此在開發人員工具中的 <code class=\"hm hn ho hp hq b\">Network</code> 中就看不到 <code class=\"hm hn ho hp hq b\">Request</code> 的資料，但是取而代之的是，那些傳遞過程可以透過第一次要求連接時的 <code class=\"hm hn ho hp hq b\">Request</code> 中觀察：</p>\n<div><img class=\"dz t u jy ak\" src=\"https://miro.medium.com/max/2124/1*b-CROiddSOb1YWQnbUHJTA.gif\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>&#x89C0;&#x5BDF;&#x5728; WebSocket &#x5354;&#x5B9A;&#x7684;&#x50B3;&#x8F38;&#x65B9;&#x5F0F;</span>\n          </div></div><br>\n<p>關於 <code class=\"hm hn ho hp hq b\">WebSocket</code> 從 Client 或是 Server 在 <code class=\"hm hn ho hp hq b\">send</code> 資料時，除了字串外還可以使用 <code class=\"hm hn ho hp hq b\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/USVString\" class=\"dj by jm jn jo jp\" target=\"_blank\" rel=\"noopener nofollow\">USVString</a></code> 、 <code class=\"hm hn ho hp hq b\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer\" class=\"dj by jm jn jo jp\" target=\"_blank\" rel=\"noopener nofollow\">ArrayBuffer</a></code> 、 <code class=\"hm hn ho hp hq b\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Blob\" class=\"dj by jm jn jo jp\" target=\"_blank\" rel=\"noopener nofollow\">Blod</a></code> 和 <code class=\"hm hn ho hp hq b\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/ArrayBufferView\" class=\"dj by jm jn jo jp\" target=\"_blank\" rel=\"noopener nofollow\">ArrayBufferView</a></code> 等型態（這部分感謝 <a class=\"dj by jm jn jo jp\" target=\"_blank\" rel=\"noopener\" href=\"/@cgh20xx?source=responses---------0---------------------\">Hank Hsiao</a> 留言提醒）。</p>\n<p>另外，要傳送 <code class=\"hm hn ho hp hq b\">JSON</code> 的資料的時，記得在 <code class=\"hm hn ho hp hq b\">send</code> 中做 <code class=\"hm hn ho hp hq b\">JSON.stringify</code> ，接收到時再用 <code class=\"hm hn ho hp hq b\">JSON.parse</code> 轉成物件處理即可！</p>\n<p>如果想找個伺服器部署 <code class=\"hm hn ho hp hq b\">WebSocket</code> ，可以參考「<a class=\"dj by jm jn jo jp\" target=\"_blank\" rel=\"noopener\" href=\"/heroku-deploy/\">Heroku | 搭配 Git 在 Heroku 上部署網站的手把手教學</a>」</p>\n<hr>\n<p>本文介紹了 <code class=\"hm hn ho hp hq b\">WebSocket</code> 的基本使用方式及一些例子，希望能夠減少各位研究的時間，這幾天還會接著研究如何搭配 <code class=\"hm hn ho hp hq b\">React</code> 。</p>\n<p>如果文章中有任何問題，或是不理解的地方，都可以留言告訴我！謝謝大家！</p>\n<p>參考文章</p>\n<ol>\n<li id=\"0fc8\" class=\"gy gz em at ha b hb ig hd ih hf ii hh ij hj ik hl la lb lc\"><a href=\"https://devcenter.heroku.com/articles/node-websockets\" class=\"dj by jm jn jo jp\" target=\"_blank\" rel=\"noopener nofollow\">https://devcenter.heroku.com/articles/node-websockets</a></li><li id=\"0839\" class=\"gy gz em at ha b hb ld hd le hf lf hh lg hj lh hl la lb lc\"><a href=\"http://www.ruanyifeng.com/blog/2017/05/websocket.html\" class=\"dj by jm jn jo jp\" target=\"_blank\" rel=\"noopener nofollow\">http://www.ruanyifeng.com/blog/2017/05/websocket.html</a></li>\n</ol>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"前言"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"最近因為工作的關係接觸到 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" ， "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 是網路協定的一種， Client 可以透過此協定與 Server 做溝通，而他和一般 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"http"}]},{"type":"text","value":" 或 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"https"}]},{"type":"text","value":" 不同的是， "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 協定只需透過一次連結便能保持連線，不必再透過一直發送 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"Request"}]},{"type":"text","value":" 來與 Server 互動！"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如前言所說， "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 只需開啟連結便能和 Server 做溝通，且 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"Websocket"}]},{"type":"text","value":" 傳送資料的方式是雙向的， Client 端可以像 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"Ajax"}]},{"type":"text","value":" 一樣做請求， Server 端也能主動發送 Client 所需要的資料。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"一般的 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 請求網址會長這個樣子："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"span","properties":{"id":"eaa9","className":["is","gm","em","at","hq","b","fh","it","iu","r","iv"]},"children":[{"type":"text","value":"ws://example.com"}]},{"type":"element","tagName":"span","properties":{"id":"7253","className":["is","gm","em","at","hq","b","fh","iw","ix","iy","iz","ja","iu","r","iv"]},"children":[{"type":"text","value":"//經過 "},{"type":"comment","value":" "},{"type":"text","value":"SSL"},{"type":"comment","value":" "},{"type":"text","value":" 加密後，前方的 "},{"type":"comment","value":" "},{"type":"text","value":"ws"},{"type":"comment","value":" "},{"type":"text","value":" 會變成 "},{"type":"comment","value":" "},{"type":"text","value":"wss"},{"type":"comment","value":" "},{"type":"text","value":" "},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"wss://example.com"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n### Server 端 - 搭建 WebSocket 環境\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 的 Server 部分，本文會以 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"Node.js"}]},{"type":"text","value":" 建置，如果電腦上還沒有安裝 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"Node.js"}]},{"type":"text","value":" 可以先參考「"},{"type":"element","tagName":"a","properties":{"href":"https://ithelp.ithome.com.tw/articles/10199058","className":["dj","by","jm","jn","jo","jp"],"target":"_blank","rel":["noopener","nofollow"]},"children":[{"type":"text","value":"[筆記][node.js]第一次建置node.js開發環境和安裝npm就上手！"}]},{"type":"text","value":"」。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"處理好安裝環境後還需要在下載兩個套件，分別是用來開發 Web 框架的 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"express"}]},{"type":"text","value":" 和負責處理 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 協定的 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"ws"}]},{"type":"text","value":" ："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"span","properties":{"id":"ca26","className":["is","gm","em","at","hq","b","fh","it","iu","r","iv"]},"children":[{"type":"text","value":"npm install express"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"npm install ws"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"安裝完後可以到專案中的 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"package.json"}]},{"type":"text","value":" 中確認是否成功："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["dz","t","u","jy","ak"],"src":"https://miro.medium.com/max/2108/1*EgbqxHT8iSGFbikO5oRVSg.png","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"下載完後的套件會被記錄到 package.json 中"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"接著在專案裡新增一個 JavaScript 檔案 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"server.js"}]},{"type":"text","value":" 當作專案的進入點："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//import express 和 ws 套件"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" express "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"require"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'express'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" SocketServer "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"require"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'ws'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"Server\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//指定開啟的 port"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"PORT"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3000"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//創建 express 的物件，並綁定及監聽 3000 port ，且設定開啟後在 console 中提示"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" server "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"express"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"listen"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"PORT"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","template-string"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","template-punctuation","string"]},"children":[{"type":"text","value":"`"}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"Listening on "}]},{"type":"element","tagName":"span","properties":{"className":["token","interpolation"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","interpolation-punctuation","punctuation"]},"children":[{"type":"text","value":"${"}]},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"PORT"}]},{"type":"element","tagName":"span","properties":{"className":["token","interpolation-punctuation","punctuation"]},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tagName":"span","properties":{"className":["token","template-punctuation","string"]},"children":[{"type":"text","value":"`"}]}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//將 express 交給 SocketServer 開啟 WebSocket 的服務"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" wss "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"SocketServer"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" server "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//當 WebSocket 從外部連結時執行"}]},{"type":"text","value":"\nwss"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'connection'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"ws"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//連結時執行此 console 提示"}]},{"type":"text","value":"\n    console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'Client connected'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//當 WebSocket 的連線關閉時執行"}]},{"type":"text","value":"\n    ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'close'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'Close connected'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"沒問題後便可以輸入以下指令執行 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"server.js"}]},{"type":"text","value":" ："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"span","properties":{"id":"6c86","className":["is","gm","em","at","hq","b","fh","it","iu","r","iv"]},"children":[{"type":"text","value":"node server.js"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"當本機 Server 的指定 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"Port"}]},{"type":"text","value":" 被打開時，會先執行我們監聽指定的事件："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["dz","t","u","jy","ak"],"src":"https://miro.medium.com/max/1756/1*VAiVKJFcfHjAIll0WDRCxg.png","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"開啟成功後會在 console 中打印提示"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Client 端 - 連接 WebSocket Server"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Server 端處理完後，就換到 Client 端來連結剛剛開啟的 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 服務，這裡另外建一個專案，在專案裡只需一個 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"index.html"}]},{"type":"text","value":" 及 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"index.js"}]},{"type":"text","value":" ："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"index.html"}]},{"type":"text","value":" 的部分先簡單處理，只需引用 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"index.js"}]},{"type":"text","value":" 就可以了："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"html"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-html"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-html"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"html"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"body"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"script"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","attr-name"]},"children":[{"type":"text","value":"src"}]},{"type":"element","tagName":"span","properties":{"className":["token","attr-value"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"'"}]},{"type":"text","value":"./index.js"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"'"}]}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"element","tagName":"span","properties":{"className":["token","script"]},"children":[]},{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"</"}]},{"type":"text","value":"script"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"</"}]},{"type":"text","value":"body"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"</"}]},{"type":"text","value":"html"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"index.js"}]},{"type":"text","value":" 的部分會用來處理與 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 的連結："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//使用 WebSocket 的網址向 Server 開啟連結"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"let"}]},{"type":"text","value":" ws "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'ws://localhost:3000'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//開啟後執行的動作，指定一個 function 會在連結 WebSocket 後執行"}]},{"type":"text","value":"\nws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"onopen"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'open connection'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//關閉後執行的動作，指定一個 function 會在連結中斷後執行"}]},{"type":"text","value":"\nws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"onclose"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'close connection'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"上方的 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"url"}]},{"type":"text","value":" 為剛剛使用 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"node.js"}]},{"type":"text","value":" 在本機上執行的 Server ，另外的 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"onopen"}]},{"type":"text","value":" 及 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"onclose"}]},{"type":"text","value":" 分別為他們指定一個 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"Function"}]},{"type":"text","value":" ，在開啟和關閉連線時執行，執行結果："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["dz","t","u","jy","ak"],"src":"https://miro.medium.com/max/3324/1*8CvZuLeH3jKwJ8_7gc8sHQ.png","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"開啟連結後會執行 onopen 的事件"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"執行結果中可以看到 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"onopen"}]},{"type":"text","value":" 中在 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"console"}]},{"type":"text","value":" 打印的提示，除此之外，也可以從剛剛執行 Server 的地方觀察開啟連結後的訊息："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["dz","t","u","jy","ak"],"src":"https://miro.medium.com/max/1772/1*y6Ivv4bi2kjIws-GxmTVYQ.png","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"在 Server 上執行時記錄的訊息"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"上方也列出 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 的物件有哪些屬性，比較重要的還有 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"onmessage"}]},{"type":"text","value":" ， Client 就是靠它在接收由 Server 發送的資料，但在提到它之前，得先回到 Server 了解如何和 Client 做溝通。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"回到 Server 端 - 處理接收發送訊息"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"提到溝通，過程一定是有來有往，在開啟 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 後， Server 端會使用 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"send"}]},{"type":"text","value":" 發送訊息，接收則是如同在 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"connection"}]},{"type":"text","value":" 內監聽 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"close"}]},{"type":"text","value":" 一樣，只是換成對 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"message"}]},{"type":"text","value":" 設定監聽，並接收一個參數 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"data"}]},{"type":"text","value":" ，捕獲 Client 端發送的訊息："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"text","value":"wss"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'connection'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"ws"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'Client connected'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//對 message 設定監聽，接收從 Client 發送的訊息"}]},{"type":"text","value":"\n    ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'message'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"data"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//data 為 Client 發送的訊息，現在將訊息原封不動發送出去"}]},{"type":"text","value":"\n        ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"send"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"data"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n    ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'close'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'Close connected'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"回到 Client 端 - 處理接收發送訊息"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"剛剛處理完 Server ，要換回 Client 端使用 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"onmessage"}]},{"type":"text","value":" 處理接收及 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"send"}]},{"type":"text","value":" 送出訊息："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"let"}]},{"type":"text","value":" ws "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'ws://localhost:3000'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\nws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"onopen"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'open connection'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\nws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"onclose"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'close connection'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//接收 Server 發送的訊息"}]},{"type":"text","value":"\nws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"onmessage"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"event"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"event"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"onmessage"}]},{"type":"text","value":" 指定的函式中多了一個參數 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"event"}]},{"type":"text","value":" ，裡面會有這次溝通的詳細訊息，從 Server 回傳的資料會在 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"event"}]},{"type":"text","value":" 的 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"data"}]},{"type":"text","value":" 屬性中。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"但是上方的程式碼還沒有增加在 Client 中發送訊息的 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"send"}]},{"type":"text","value":" ，因此下方在連接到 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 後直接在 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"console"}]},{"type":"text","value":" 中發送，並確認回傳訊息："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["dz","t","u","jy","ak"],"src":"https://miro.medium.com/max/3832/1*oL40RiJz591Lbn4vrSBOHg.png","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"Server 接收 Client 發送的訊息後再回傳"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"不過上面看起來還是以 Client 做 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"send"}]},{"type":"text","value":" 發送訊息給 Server 處理過才得到回傳資料，該怎麼從 Server 上直接發送呢？很簡單，只需要透過 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"setInterval"}]},{"type":"text","value":" 就能讓 Server 在固定時間發送資料給 Client ，例如下方的例子："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"text","value":"wss"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'connection'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"ws"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'Client connected'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//固定送最新時間給 Client"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" sendNowTime "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setInterval"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"send"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"String"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Date"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1000"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n    ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'message'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"data"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"send"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"data"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n    ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'close'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//連線中斷時停止 setInterval"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"clearInterval"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"sendNowTime"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'Close connected'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Client 連結後的結果如下："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["dz","t","u","jy","ak"],"src":"https://miro.medium.com/max/2076/1*AHKxAKEo8YuDePJjzDNtmQ.png","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"不斷接收 Server 主動傳遞的訊息"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"最後一次回到 Server - 多人連線"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"通常 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 都會運用在聊天室，但是就剛剛的使用方式來說，今天 ClientA 和 ClientB 都連結同一個 Server ，而他們各自在 Client 使用 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"send"}]},{"type":"text","value":" 發送資料給 Server ， 在這個情況下 Server 只會依據兩個 Client 各自發送的內容，再分別回傳給 ClientA 和 ClientB ，並無法讓 ClientB 能夠在 ClientA 發送訊息時也收到回傳的資料。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"例如以下例子，用兩個視窗開啟 Client 並各自發送請求："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["dz","t","u","jy","ak"],"src":"https://miro.medium.com/max/1276/1*ZIy6Qp5D3qkUWhpstPdKTg.gif","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"客戶端無法共享 Server 發送的訊息"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"那該怎麼像廣播一樣，當我在某一個 Client 發送訊息時，讓 Server 告知所有其他同時連接中的 Client 都知道我對 Server 發送這個訊息，也同時接收到 Server 回傳的資料呢？"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"答案就在一開始下載的套件 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"ws"}]},{"type":"text","value":" 中，它可以使用 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"clients"}]},{"type":"text","value":" 找出當前所有連結中的 Client 資訊，並透過迴圈將訊息發送至每一個 Client 中："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"text","value":"wss"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'connection'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"ws"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'Client connected'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n    ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'message'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"data"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//取得所有連接中的 client"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"let"}]},{"type":"text","value":" clients "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" wss"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"clients\n\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//做迴圈，發送訊息至每個 client"}]},{"type":"text","value":"\n        clients"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"forEach"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"client"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n            client"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"send"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"data"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n    ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'close'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'Close connected'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"這麼一來，不論是哪個 Client 端發送訊息， Server 都會將訊息回覆給所有連接中的 Client ："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["dz","t","u","jy","ak"],"src":"https://miro.medium.com/max/1276/1*9ETT853cZxzHKDcBfBCyqA.gif","role":"presentation"},"children":[]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"補充內容"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"雖然在 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 的協定上 Client 和 Server 不需再通過 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"Request"}]},{"type":"text","value":" ，因此在開發人員工具中的 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"Network"}]},{"type":"text","value":" 中就看不到 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"Request"}]},{"type":"text","value":" 的資料，但是取而代之的是，那些傳遞過程可以透過第一次要求連接時的 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"Request"}]},{"type":"text","value":" 中觀察："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["dz","t","u","jy","ak"],"src":"https://miro.medium.com/max/2124/1*b-CROiddSOb1YWQnbUHJTA.gif","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"觀察在 WebSocket 協定的傳輸方式"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"關於 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 從 Client 或是 Server 在 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"send"}]},{"type":"text","value":" 資料時，除了字串外還可以使用 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"element","tagName":"a","properties":{"href":"https://developer.mozilla.org/en-US/docs/Web/API/USVString","className":["dj","by","jm","jn","jo","jp"],"target":"_blank","rel":["noopener","nofollow"]},"children":[{"type":"text","value":"USVString"}]}]},{"type":"text","value":" 、 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"element","tagName":"a","properties":{"href":"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer","className":["dj","by","jm","jn","jo","jp"],"target":"_blank","rel":["noopener","nofollow"]},"children":[{"type":"text","value":"ArrayBuffer"}]}]},{"type":"text","value":" 、 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"element","tagName":"a","properties":{"href":"https://developer.mozilla.org/en-US/docs/Web/API/Blob","className":["dj","by","jm","jn","jo","jp"],"target":"_blank","rel":["noopener","nofollow"]},"children":[{"type":"text","value":"Blod"}]}]},{"type":"text","value":" 和 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"element","tagName":"a","properties":{"href":"https://developer.mozilla.org/en-US/docs/Web/API/ArrayBufferView","className":["dj","by","jm","jn","jo","jp"],"target":"_blank","rel":["noopener","nofollow"]},"children":[{"type":"text","value":"ArrayBufferView"}]}]},{"type":"text","value":" 等型態（這部分感謝 "},{"type":"element","tagName":"a","properties":{"className":["dj","by","jm","jn","jo","jp"],"target":"_blank","rel":["noopener"],"href":"/@cgh20xx?source=responses---------0---------------------"},"children":[{"type":"text","value":"Hank Hsiao"}]},{"type":"text","value":" 留言提醒）。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"另外，要傳送 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"JSON"}]},{"type":"text","value":" 的資料的時，記得在 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"send"}]},{"type":"text","value":" 中做 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"JSON.stringify"}]},{"type":"text","value":" ，接收到時再用 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"JSON.parse"}]},{"type":"text","value":" 轉成物件處理即可！"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果想找個伺服器部署 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" ，可以參考「"},{"type":"element","tagName":"a","properties":{"className":["dj","by","jm","jn","jo","jp"],"target":"_blank","rel":["noopener"],"href":"/heroku-deploy/"},"children":[{"type":"text","value":"Heroku | 搭配 Git 在 Heroku 上部署網站的手把手教學"}]},{"type":"text","value":"」"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"本文介紹了 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 的基本使用方式及一些例子，希望能夠減少各位研究的時間，這幾天還會接著研究如何搭配 "},{"type":"element","tagName":"code","properties":{"className":["hm","hn","ho","hp","hq","b"]},"children":[{"type":"text","value":"React"}]},{"type":"text","value":" 。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果文章中有任何問題，或是不理解的地方，都可以留言告訴我！謝謝大家！"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"參考文章"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"id":"0fc8","className":["gy","gz","em","at","ha","b","hb","ig","hd","ih","hf","ii","hh","ij","hj","ik","hl","la","lb","lc"]},"children":[{"type":"element","tagName":"a","properties":{"href":"https://devcenter.heroku.com/articles/node-websockets","className":["dj","by","jm","jn","jo","jp"],"target":"_blank","rel":["noopener","nofollow"]},"children":[{"type":"text","value":"https://devcenter.heroku.com/articles/node-websockets"}]}]},{"type":"element","tagName":"li","properties":{"id":"0839","className":["gy","gz","em","at","ha","b","hb","ld","hd","le","hf","lf","hh","lg","hj","lh","hl","la","lb","lc"]},"children":[{"type":"element","tagName":"a","properties":{"href":"http://www.ruanyifeng.com/blog/2017/05/websocket.html","className":["dj","by","jm","jn","jo","jp"],"target":"_blank","rel":["noopener","nofollow"]},"children":[{"type":"text","value":"http://www.ruanyifeng.com/blog/2017/05/websocket.html"}]}]},{"type":"text","value":"\n"}]}],"data":{"quirksMode":false}},"excerpt":"前言 最近因為工作的關係接觸到 WebSocket ， WebSocket 是網路協定的一種， Client 可以透過此協定與 Server 做溝通，而他和一般 http 或 https 不同的是， WebSocket…","timeToRead":5,"frontmatter":{"title":"JavaScript | WebSocket 讓前後端沒有距離","userDate":"23 February 2019","date":"2019-02-23T13:45:54.149Z","tags":["JavaScript","WebSocket"],"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAECAwX/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQMF/9oADAMBAAIQAxAAAAHQjcZtUMR//8QAGxAAAQQDAAAAAAAAAAAAAAAAAQACAxAREjH/2gAIAQEAAQUCJdnaRDl//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGxAAAQQDAAAAAAAAAAAAAAAAAAIRICEygaH/2gAIAQEABj8CpL7MOlw//8QAGxAAAQQDAAAAAAAAAAAAAAAAEQABITEgQVH/2gAIAQEAAT8haUnYKCqkAB9th//aAAwDAQACAAMAAAAQv/8A/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFhEBAQEAAAAAAAAAAAAAAAAAARBR/9oACAECAQE/EBMn/8QAGhABAAIDAQAAAAAAAAAAAAAAAREhACAxcf/aAAgBAQABPxA8DDaFsgSyzwHMTQFKGQfdP//Z","aspectRatio":2.1183932346723044,"src":"/static/e87971a563d150dcfc0d784bf20dbb37/f04f7/JavaScript.jpg","srcSet":"/static/e87971a563d150dcfc0d784bf20dbb37/f8f18/JavaScript.jpg 930w,\n/static/e87971a563d150dcfc0d784bf20dbb37/0e6ff/JavaScript.jpg 1860w,\n/static/e87971a563d150dcfc0d784bf20dbb37/f04f7/JavaScript.jpg 2004w","sizes":"(max-width: 2004px) 100vw, 2004px"}}},"author":{"id":"GQSM","bio":"Enjoy life enjoy coding!","avatar":{"children":[{"__typename":"ImageSharp","fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAC4jAAAuIwF4pT92AAACIElEQVQ4y5WTz2saQRTHd3Y3/mrxV6NbsYoIUmtMDkkrXoVgvRQUVMiteLGQ/6G9KKVC0d5CG0/NxRx6kRZ6aC8JND0KOcdzKLTgyUTd6XvL2zCUVqcDX77uzLyPb96bURRhdDodyweDAVP+Mjjnlo9GI0V69Pt9RsG36/X6i1wud9xoNPZt2Hg8locNh8Ob34VC4aPD4UAK93q9vFKpvKYl1YavHNVqVUVvtVqPwuEwRl2rqnqF0Hg8/nM6nRq43u12mRQQjmgB2+32Q8MwELjQNG2BwEQicTmZTCxgr9eTA9JRrM3FYvGD0+nEiSufz8fL5XKPtmnSR7ZhMJyBQOAkk8nwbDY7S6fT3O12f4f5e3/skwa+w4RBM/I5+SHIIwtVyfegbhyaMYeszFQqZcKcqes6pwY9kz7vt7MztPM76+s8Go3OSqUSh0aZeORgMHgdCoUwy88ejycok6Wd4fNkMsmhEYtarWY2m00TwKbf7zcjkQgC69AsrKVbOtN8Pn+ENQPADDKcx2Kxucvl4ts7O29wHS58GCyxMkuokW7dC03bZ4xZ91BsCryYXYvA2BrYFshYlZxOfoAACPwF8PcC+CUoCnoA2sQXKpRq6bX5RIC3oFugL/R9tCTmnwtY7AvQJchPc/cJ+FVoIJO91Hcp+Cl9r5G/Av0Quit9sZ+AToUgMfNzaoayqnbiP25TwcUg2x+DNv7nPbMlxZYC/AYn5p1FkAm0lwAAAABJRU5ErkJggg==","width":400,"height":402,"src":"/static/bca487154c11d830750d2707c9e6d3e5/4e842/gqsm.png","srcSet":"/static/bca487154c11d830750d2707c9e6d3e5/4e842/gqsm.png 1x,\n/static/bca487154c11d830750d2707c9e6d3e5/fca9c/gqsm.png 1.5x,\n/static/bca487154c11d830750d2707c9e6d3e5/94286/gqsm.png 2x"}}]}}}},"relatedPosts":{"totalCount":17,"edges":[{"node":{"id":"4e30fa7d-e3e5-57b4-add0-b9682054e469","timeToRead":1,"excerpt":"前言 Hi！大家好，我是神 Q 超人。這篇是練習演算法的文章，雖然目前還是很菜，但是希望可以藉由把自己的解法分享給大家，來互相討論得到進步！ 題目：56. Merge Intervals 難易度：Medium…","frontmatter":{"title":"JS 的演算法養成之路 | Merge Intervals"},"fields":{"slug":"/algorithms-merge-intervals/"}}},{"node":{"id":"9507b5af-d833-5726-869b-aff8c9f7a722","timeToRead":3,"excerpt":"嗨！大家好我是神Q超人！先前一陣子經過友人介紹認識了這個網站，但是由於先前已經有用習慣分享文章的平台，就遲遲未到此處發文，一直到參與完該平台舉辦的鐵人賽後，休息了好一陣子，最後沒有得獎也是很失落，於是想說在新的一年讓自己有個新開始！請大家多多指教！ 認識 Promise…","frontmatter":{"title":"JavaScript | 從Promise開始承諾的部落格生活"},"fields":{"slug":"/js-promise/"}}},{"node":{"id":"6f22dcc0-a5ec-58e1-8efc-ab3a9ca27030","timeToRead":4,"excerpt":"Hello I am Clark! Today we’re gonna write test case of unit testing for DOM manipulation. If we have a piece code of HTML and JavaScript in…","frontmatter":{"title":"Jest | Use Jest write unit testing for DOM manipulation"},"fields":{"slug":"/unit-testing-for-dom-manipulation/"}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/js-websocket/","prev":{"excerpt":"前言 最早接觸到 Heroku 這個伺服器是在去年某個午後，那時候不知道發生什麼事，突然想用 Python 做一個有簡單功能的 Line 機器人，才發現這個好用的雲端伺服器，當初有將實作過程隨手記錄在 Trello…","timeToRead":3,"frontmatter":{"title":"Heroku | 搭配 Git 在 Heroku 上部署網站的手把手教學 feat. NodeJs","tags":["Heroku","Nodejs"],"date":"2019-02-21T15:49:59.149Z","draft":false,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.9312839059674503,"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAd5OSgD/xAAWEAEBAQAAAAAAAAAAAAAAAAAAESD/2gAIAQEAAQUCVMf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAXEAADAQAAAAAAAAAAAAAAAAABECAh/9oACAEBAAY/Aloj/8QAGRABAAMBAQAAAAAAAAAAAAAAAQARMRAh/9oACAEBAAE/IcirCn2IcLjL5//aAAwDAQACAAMAAAAQGM//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAcEAEAAwACAwAAAAAAAAAAAAABABEhMUFRYXH/2gAIAQEAAT8QdUFHVECLzGsPs10+xcSHMtmvMuf/2Q==","sizes":"(max-width: 2136px) 100vw, 2136px","src":"/static/b675f210358362faae7ef595cb90abad/d11aa/heroku-deploy.jpg","srcSet":"/static/b675f210358362faae7ef595cb90abad/f8f18/heroku-deploy.jpg 930w,\n/static/b675f210358362faae7ef595cb90abad/0e6ff/heroku-deploy.jpg 1860w,\n/static/b675f210358362faae7ef595cb90abad/d11aa/heroku-deploy.jpg 2136w"}}},"author":{"id":"GQSM","bio":"Enjoy life enjoy coding!","avatar":{"children":[{"fixed":{"src":"/static/bca487154c11d830750d2707c9e6d3e5/4e842/gqsm.png"}}]}}},"fields":{"layout":"post","slug":"/heroku-deploy/"}},"next":{"excerpt":"前言 這次的標題有點複雜和騙人，文章內主要是在 React 中搭配 Socket.io 做使用，而 Socket.io 是一個現成的 WebSocket 套件，儘管它不是真正的 webSocket 協定，但 socket.io 還是實現了 webSocket…","timeToRead":8,"frontmatter":{"title":"React | 在 React 中使用 WebSocket - feat. Socket.io 基本教學","tags":["React"],"date":"2019-03-08T17:35:55.149Z","draft":false,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.828099173553719,"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAIDBf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAAByp0nIT//xAAXEAEAAwAAAAAAAAAAAAAAAAABABIg/9oACAEBAAEFAgGUM//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABkQAAEFAAAAAAAAAAAAAAAAAAEAESAhMv/aAAgBAQAGPwKyy2I//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABPyFQh//aAAwDAQACAAMAAAAQv9//xAAWEQEBAQAAAAAAAAAAAAAAAAABEFH/2gAIAQMBAT8QR2f/xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPxCn/8QAHRAAAQIHAAAAAAAAAAAAAAAAAREhACAxQVFhcf/aAAgBAQABPxCmDgHFsxwV2sv/2Q==","sizes":"(max-width: 2212px) 100vw, 2212px","src":"/static/b7a8f321b0bbc07ca9b9d22a7a505ed5/97b31/React.jpg","srcSet":"/static/b7a8f321b0bbc07ca9b9d22a7a505ed5/f8f18/React.jpg 930w,\n/static/b7a8f321b0bbc07ca9b9d22a7a505ed5/0e6ff/React.jpg 1860w,\n/static/b7a8f321b0bbc07ca9b9d22a7a505ed5/97b31/React.jpg 2212w"}}},"author":{"id":"GQSM","bio":"Enjoy life enjoy coding!","avatar":{"children":[{"fixed":{"src":"/static/bca487154c11d830750d2707c9e6d3e5/4e842/gqsm.png"}}]}}},"fields":{"layout":"post","slug":"/use-websocket-by-react-socket-io/"}},"primaryTag":"JavaScript"}}}