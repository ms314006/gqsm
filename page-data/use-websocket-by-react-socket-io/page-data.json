{"componentChunkName":"component---src-templates-post-tsx","path":"/use-websocket-by-react-socket-io/","webpackCompilationHash":"3e216d6caac7b3e6da75","result":{"data":{"logo":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAC4jAAAuIwF4pT92AAABEElEQVQoz6XSQUsCQRTA8d1tt4UQlAj0Jt08W0RSeDNBTLrXRdQMBEEFEUUE6WKXbl26ePADdNFv4qFP0TfY7f+2tzEknhr48ebN7nvMzK4VhqFljiAIosi6w/xAcuY2ZG4LmeuaI/XK+e3FpIAtruNm1n8GDW7Cn3GnuajgEUnkMMQpMmjiEkUc6+7L5g6X+MJG8ystKmrjAQXStI0eFuR5SN09zrE2d7jShh96Pw+4QAnvaOn9PuOMvIax7Jp8TpxhBC9uOMUnXjTPoo8JniiqEl/xpvMOsUu8JdblaohybUdSfIgGCwk9pq9NfZwYp0jxTvwsLV/5z3ewozvUI7q66FHkmr9S/Fvs+Zg7z78BWv9x1aNpq+AAAAAASUVORK5CYII=","width":400,"height":167,"src":"/static/47b2a725da5afc6280b3ee7d8fac6b1a/647de/gqsm-logo.png","srcSet":"/static/47b2a725da5afc6280b3ee7d8fac6b1a/647de/gqsm-logo.png 1x,\n/static/47b2a725da5afc6280b3ee7d8fac6b1a/59139/gqsm-logo.png 1.5x,\n/static/47b2a725da5afc6280b3ee7d8fac6b1a/af144/gqsm-logo.png 2x"}}},"markdownRemark":{"html":"<h2>前言</h2>\n<p>這次的標題有點複雜和騙人，文章內主要是在 <code class=\"hf ip iq ir is b\">React</code> 中搭配 <code class=\"hf ip iq ir is b\">Socket.io</code> 做使用，而 <code class=\"hf ip iq ir is b\">Socket.io</code> 是一個現成的 <code class=\"hf ip iq ir is b\">WebSocket</code> 套件，儘管它不是真正的 <code class=\"hf ip iq ir is b\">webSocket</code> 協定，但 <code class=\"hf ip iq ir is b\">socket.io</code> 還是實現了 <code class=\"hf ip iq ir is b\">webSocket</code> 及增加許多方便的功能。</p>\n<p>如果還不了解 <code class=\"hf ip iq ir is b\">WebSocket</code> 的讀者，可以先參考「<a class=\"cx ga iy iz ja jb\" target=\"_blank\" rel=\"noopener\" href=\"http://localhost:8000/js-websocket/\">JavaScript | WebSocket 讓前後端沒有距離</a>」文章內解說的原生使用方式，當然也能直接選擇學習 <code class=\"hf ip iq ir is b\">Socket.io</code> 就好，但文中的例子都會以 <code class=\"hf ip iq ir is b\">React</code> 的<code class=\"hf ip iq ir is b\">Function Component</code> 配合 <code class=\"hf ip iq ir is b\">Hooks</code> 撰寫，就不再另外列舉在一般 <code class=\"hf ip iq ir is b\">HTML</code> 的用法。</p>\n<p>另外， Server 方面會以 <code class=\"hf ip iq ir is b\">Node.js</code> 建置，還沒碰過 <code class=\"hf ip iq ir is b\">Node.js</code> 的話也能參考「<a href=\"https://ithelp.ithome.com.tw/articles/10199058\" class=\"cx ga iy iz ja jb\" target=\"_blank\" rel=\"noopener nofollow\">[筆記][node.js]第一次建置node.js開發環境和安裝npm就上手！</a>」建置環境，有任何問題再麻煩留言告訴我，謝謝！</p>\n<hr>\n<h2>Socket.io</h2>\n<p><code class=\"hf ip iq ir is b\">socket.io</code> 分成兩個主要的部分，一個是負責在 Server 端啟動 <code class=\"hf ip iq ir is b\">WebSocket</code> 服務的 <code class=\"hf ip iq ir is b\">socket.io</code> 和在 Client 端做連結處理的 <code class=\"hf ip iq ir is b\">socket.io-client</code> ，因此使用時便不需要再尋找 Server 及 Client 各需要哪些套件，一切都交給 <code class=\"hf ip iq ir is b\">socket.io</code> 就行了。</p>\n<h3>基本溝通方式解說</h3>\n<p>下方會先從建立 Server 的 <code class=\"hf ip iq ir is b\">socket.io</code> 開始敘述，再解釋兩邊的互動方式。</p>\n<h3>Server</h3>\n<p>以 <code class=\"hf ip iq ir is b\">npm init</code> 建立一個專案後，透過下列指令安裝 <code class=\"hf ip iq ir is b\">express</code> 和 <code class=\"hf ip iq ir is b\">socket.io</code> ：</p>\n<pre><span id=\"b296\" class=\"jq hr ea ar is b fd ke kf r kg\">npm install express<br>npm install socket.io</span></pre></br>\n<p>安裝完後在專案內建立一個 <code class=\"hf ip iq ir is b\">server.js</code> ，用來做專案的進入點運行 Server：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">//將 express 放進 http 中開啟 Server 的 3000 port ，正確開啟後會在 console 中印出訊息</span>\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Server</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'open server!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">//將啟動的 Server 送給 socket.io 處理</span>\n<span class=\"token keyword\">const</span> io <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'socket.io'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">/*上方為此寫法的簡寫：\n  const socket = require('socket.io')\n  const io = socket(server)\n*/</span>\n\n<span class=\"token comment\">//監聽 Server 連線後的所有事件，並捕捉事件 socket 執行</span>\nio<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'connection'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">socket</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//經過連線後在 console 中印出訊息</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'success connect!'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">//監聽透過 connection 傳進來的事件</span>\n    socket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessage'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">message</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//回傳 message 給發送訊息的 Client</span>\n        socket<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessage'</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"hf ip iq ir is b\">server.js</code> 內有幾點需要注意的地方：</p>\n<ol>\n<li id=\"6525\" class=\"ib ic ea ar id b ie it ig iu ii iv ik iw im ix io ki kj kk\">如果是使用 <code class=\"hf ip iq ir is b\">socket.io</code> 套件，因為它不是真正的 <code class=\"hf ip iq ir is b\">webSocket</code> 協定，所以還是得使用 <code class=\"hf ip iq ir is b\">http</code> 啟動 Server ，再把 Server 物件送給 <code class=\"hf ip iq ir is b\">socket.io</code> ，處理過後會得到一個物件 <code class=\"hf ip iq ir is b\">io</code> ，可以用它的 <code class=\"hf ip iq ir is b\">on</code> 監聽開啟連線後的設定。</li><li id=\"9a62\" class=\"ib ic ea ar id b ie kl ig km ii kn ik ko im kp io ki kj kk\">如果 <code class=\"hf ip iq ir is b\">io</code> 監聽到有訊息從 Client 傳到 Server 時，會將捕捉到的事件內容 <code class=\"hf ip iq ir is b\">socket</code> 物件傳至 <code class=\"hf ip iq ir is b\">connection</code> 後的 <code class=\"hf ip iq ir is b\">function</code> 中。</li><li id=\"a0d3\" class=\"ib ic ea ar id b ie kl ig km ii kn ik ko im kp io ki kj kk\">被傳入 <code class=\"hf ip iq ir is b\">connection</code> 中的 <code class=\"hf ip iq ir is b\">socket</code> 也可以自訂監聽 <code class=\"hf ip iq ir is b\">message</code> 的類型，例如上方的 <code class=\"hf ip iq ir is b\">getMessage</code> 就是筆者自行設定的類型名稱， <code class=\"hf ip iq ir is b\">socket.io</code> 只會觸發對應的監聽 <code class=\"hf ip iq ir is b\">Function</code>。</li><li id=\"f844\" class=\"ib ic ea ar id b ie kl ig km ii kn ik ko im kp io ki kj kk\"><code class=\"hf ip iq ir is b\">socket.emit</code> 為回覆訊息給 Client 的 <code class=\"hf ip iq ir is b\">Function</code> ，它第一個參數為訊息類型，這個和 Server 的監聽名稱一樣，在 Client 端也只有設定監聽類型為 <code class=\"hf ip iq ir is b\">getMessage</code> 的 <code class=\"hf ip iq ir is b\">Function</code> 才會觸發，而第二個為訊息內容。</li>\n</ol>\n<p>如果上方有不了解的部分，可以先大略看過，配合 Client 的運作一起看會更清楚。</p>\n<p>完成 Server 的部分後可以先輸入以下指令運行：</p>\n<pre><span id=\"0cc1\" class=\"jq hr ea ar is b fd ke kf r kg\">node server.js //server.js 為檔名</span></pre></br>\n<p>如果程式沒有問題，那應該會在運行後出現 <code class=\"hf ip iq ir is b\">open server!</code>：</p>\n<div><img class=\"s t u hb ai\" src=\"https://miro.medium.com/max/1896/1*d8HW5xzPhctTK9EDDJIT-g.png\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>&#x5728; 3000 port &#x4E0A;&#x57F7;&#x884C; server</span>\n          </div></div><br>\n<h3>Client</h3>\n<p>Client 端另外開一個專案， <code class=\"hf ip iq ir is b\">React</code> 的環境就不再另外講解，可以參考「<a href=\"https://ithelp.ithome.com.tw/articles/10200329\" class=\"cx ga iy iz ja jb\" target=\"_blank\" rel=\"noopener nofollow\">webpack&#x26;React開發環境篇(1)</a>」和「<a href=\"https://ithelp.ithome.com.tw/articles/10200459\" class=\"cx ga iy iz ja jb\" target=\"_blank\" rel=\"noopener nofollow\">webpack&#x26;React開發環境篇(2)</a>」上下兩篇搭建，那除了 <code class=\"hf ip iq ir is b\">React</code> 的部分還需要下載 <code class=\"hf ip iq ir is b\">socket.io-client</code> ：</p>\n<pre><span id=\"120a\" class=\"jq hr ea ar is b fd ke kf r kg\">npm install socket.io-client</span></pre></br>\n<p>下載後，就能開始實做一個連結 <code class=\"hf ip iq ir is b\">webSocket</code> 並能夠發送及接收訊息的 <code class=\"hf ip iq ir is b\">component</code> ：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useState<span class=\"token punctuation\">,</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword\">import</span> ReactDom <span class=\"token keyword\">from</span> <span class=\"token string\">'react-dom'</span>\n<span class=\"token keyword\">import</span> webSocket <span class=\"token keyword\">from</span> <span class=\"token string\">'socket.io-client'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Main</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>ws<span class=\"token punctuation\">,</span>setWs<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">connectWebSocket</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//開啟</span>\n        <span class=\"token function\">setWs</span><span class=\"token punctuation\">(</span><span class=\"token function\">webSocket</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3000'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>ws<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">//連線成功在 console 中打印訊息</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'success connect!'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token comment\">//設定監聽</span>\n            <span class=\"token function\">initWebSocket</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span>ws<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">initWebSocket</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//對 getMessage 設定監聽，如果 server 有透過 getMessage 傳送訊息，將會在此被捕捉</span>\n        ws<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessage'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">message</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">sendMessage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//以 emit 送訊息，並以 getMessage 為名稱送給 server 捕捉</span>\n        ws<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessage'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'只回傳給發送訊息的 client'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string\">'button'</span> value<span class=\"token operator\">=</span><span class=\"token string\">'連線'</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>connectWebSocket<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string\">'button'</span> value<span class=\"token operator\">=</span><span class=\"token string\">'送出訊息'</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>sendMessage<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nReactDom<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>Main <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>關於此 <code class=\"hf ip iq ir is b\">component</code> 的架構可以分為幾下幾塊：</p>\n<ol>\n<li id=\"87f2\" class=\"ib ic ea ar id b ie it ig iu ii iv ik iw im ix io ki kj kk\">使用 <code class=\"hf ip iq ir is b\">useState</code> 在 <code class=\"hf ip iq ir is b\">component</code> 內建立一個 <code class=\"hf ip iq ir is b\">state</code> <code class=\"hf ip iq ir is b\">ws</code> ，當使用者點擊「連線」按鈕時觸發 <code class=\"hf ip iq ir is b\">connectWebSocket</code> ，觸發後透過從 <code class=\"hf ip iq ir is b\">socket.io-client</code> 套件中 <code class=\"hf ip iq ir is b\">import</code> 的 <code class=\"hf ip iq ir is b\">webSocket</code> 連線至剛剛執行 <code class=\"hf ip iq ir is b\">server.js</code> 的 <code class=\"hf ip iq ir is b\">http://localhost:3000</code> ，最後 <code class=\"hf ip iq ir is b\">webSocket</code> 連線成功後會藉由 <code class=\"hf ip iq ir is b\">setWs</code> 將 <code class=\"hf ip iq ir is b\">WebSocket</code> 物件寫到 <code class=\"hf ip iq ir is b\">ws</code> 。</li><li id=\"6abb\" class=\"ib ic ea ar id b ie kl ig km ii kn ik ko im kp io ki kj kk\">連線後 <code class=\"hf ip iq ir is b\">component</code> 的 <code class=\"hf ip iq ir is b\">state</code> <code class=\"hf ip iq ir is b\">ws</code> 就會改變，生命週期 <code class=\"hf ip iq ir is b\">useEffect</code> 也會被觸發，觸發時先判斷 <code class=\"hf ip iq ir is b\">ws</code> 內是否真的有值，因為 <code class=\"hf ip iq ir is b\">useEffect</code> 在組件第一次 <code class=\"hf ip iq ir is b\">render</code> 時就會先執行，但那時候 <code class=\"hf ip iq ir is b\">ws</code> 還沒有連線所以是 <code class=\"hf ip iq ir is b\">null</code> ，這時候還去執行 <code class=\"hf ip iq ir is b\">initWebSocket</code> 就會發生錯誤，所以如果 <code class=\"hf ip iq ir is b\">ws</code> 還是初始值 <code class=\"hf ip iq ir is b\">null</code> 就不執行接下來的 <code class=\"hf ip iq ir is b\">initWebSocket</code> 。</li><li id=\"4b89\" class=\"ib ic ea ar id b ie kl ig km ii kn ik ko im kp io ki kj kk\">在 <code class=\"hf ip iq ir is b\">initWebSocket</code> 中替 <code class=\"hf ip iq ir is b\">ws</code> 增加了監聽 <code class=\"hf ip iq ir is b\">getMessage</code> 的訊息，當 Server 有發送以 <code class=\"hf ip iq ir is b\">getMessage</code> 為名稱的訊息，就會在這裡被捕捉到，並在第二個參數中接收訊息，將訊息內容打印到 <code class=\"hf ip iq ir is b\">console</code> 中。</li><li id=\"9f12\" class=\"ib ic ea ar id b ie kl ig km ii kn ik ko im kp io ki kj kk\">當我按下「送出訊息」按鈕時， <code class=\"hf ip iq ir is b\">sendMessage</code> 中會以 <code class=\"hf ip iq ir is b\">ws.emit</code> 送出訊息，而送出的除了訊息內容外，還有辨別他的名稱 <code class=\"hf ip iq ir is b\">getMessage</code> 。</li>\n</ol>\n<p>在第一點中需要注意的是 <code class=\"hf ip iq ir is b\">ws://localhost:3000</code> 是無法正確與 Server 做<code class=\"hf ip iq ir is b\">connection</code> 的，因為 <code class=\"hf ip iq ir is b\">socket.io</code> 本身是 <code class=\"hf ip iq ir is b\">http</code> 協定而不是 <code class=\"hf ip iq ir is b\">WebSocket</code> ，如果要看更多協議可以參考 <code class=\"hf ip iq ir is b\"><a href=\"https://github.com/socketio/socket.io-protocol#socketio-protocol\" class=\"cx ga iy iz ja jb\" target=\"_blank\" rel=\"noopener nofollow\">socket.io</a></code><a href=\"https://github.com/socketio/socket.io-protocol#socketio-protocol\" class=\"cx ga iy iz ja jb\" target=\"_blank\" rel=\"noopener nofollow\"> 的協議</a>。</p>\n<p>看到這裡，就能夠將剛剛 Server 的程式碼拿來與 Client 一起講解兩邊溝通的流程了：</p>\n<ol>\n<li id=\"257d\" class=\"ib ic ea ar id b ie it ig iu ii iv ik iw im ix io ki kj kk\">由 Client 以 <code class=\"hf ip iq ir is b\">ws.emit(&apos;getMessage&apos;,&apos;訊息內容&apos;)</code> 將訊息送到 Server。</li><li id=\"4b9e\" class=\"ib ic ea ar id b ie kl ig km ii kn ik ko im kp io ki kj kk\">Server 藉由 <code class=\"hf ip iq ir is b\">socket.on(&apos;getMessage&apos;,message=&gt;{/*執行動作*/})</code> 捕捉到訊息。</li><li id=\"cffd\" class=\"ib ic ea ar id b ie kl ig km ii kn ik ko im kp io ki kj kk\">Server 處理完訊息內容後再透過 <code class=\"hf ip iq ir is b\">socket.emit(&apos;getMessage&apos;,&apos;訊息內容&apos;)</code> 將訊息傳給 Client 。</li><li id=\"ecb0\" class=\"ib ic ea ar id b ie kl ig km ii kn ik ko im kp io ki kj kk\">最後 Client 會從 <code class=\"hf ip iq ir is b\">ws.on(&apos;getMessage&apos;,message=&gt;{/*執行動作*/})</code> 的監聽取得 Server 傳來的訊息。</li>\n</ol>\n<p>上面的過程都是以 <code class=\"hf ip iq ir is b\">getMessage</code> 為該訊息取名字去送出及監聽捕捉，因此就不會像原生的 <code class=\"hf ip iq ir is b\">WebSocket</code> ，如果要為訊息做分類就還得多做判斷，當然用 <code class=\"hf ip iq ir is b\">socket.io</code> 的方便不只有這樣子而已，先看看上方程式碼的執行畫面，再講解更多有趣的地方：</p>\n<div><img class=\"s t u hb ai\" src=\"https://miro.medium.com/max/1404/1*TY9WH2CwfJVaT_77Z-sSBg.gif\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>Server &#x56DE;&#x50B3;&#x5F9E; Client &#x4E2D;&#x6536;&#x5230;&#x7684;&#x8A0A;&#x606F;</span>\n          </div></div><br>\n<h3>進階用法 - 群發</h3>\n<p>就上方的例子而言，眼尖的讀者應該有發現，筆者在使用 <code class=\"hf ip iq ir is b\">socket.emit()</code> 將訊息從 Server 傳給 Client 的時候，訊息內容為「只回傳給發送訊息的 client 」，這也代表這段訊息不會同時讓其他連接著該 <code class=\"hf ip iq ir is b\">WebSocket</code> 的 Client 收到，那該怎麼做才能讓所有 Client 都收到訊息呢？</p>\n<p>其實 <code class=\"hf ip iq ir is b\">socket.io</code> 針對要發送的對象，提供了其他方式：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/*只回傳給發送訊息的 client*/</span>\nsocket<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessage'</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">/*回傳給所有連結著的 client*/</span>\nio<span class=\"token punctuation\">.</span>sockets<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessageAll'</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">/*回傳給除了發送者外所有連結著的 client*/</span>\nsocket<span class=\"token punctuation\">.</span>broadcast<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessageLess'</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span></code></pre></div>\n<p>每種方式也都會固定帶著一個名稱被 Client 端監聽接收，如果沒有給名稱就不會被監聽給捕捉到，以下實作呈現這三種發送訊息的方式：</p>\n<h3>Server</h3>\n<p>在 Server 端要因應不同的名稱來判斷回傳的方式，因此為幾個不同的名稱做加入監聽：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">io<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'connection'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">socket</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  \n    <span class=\"token comment\">/*只回傳給發送訊息的 client*/</span>\n    socket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessage'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">message</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        socket<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessage'</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">/*回傳給所有連結著的 client*/</span>\n    socket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessageAll'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">message</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        io<span class=\"token punctuation\">.</span>sockets<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessageAll'</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">/*回傳給除了發送者外所有連結著的 client*/</span>\n    socket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessageLess'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">message</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        socket<span class=\"token punctuation\">.</span>broadcast<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessageLess'</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  \n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Client</h3>\n<p>在 Client 中，下方更改了 <code class=\"hf ip iq ir is b\">sendMessage</code> 的內容，在呼叫的時候傳入 <code class=\"hf ip iq ir is b\">name</code> 作為發送訊息的名稱，並在 <code class=\"hf ip iq ir is b\">initWebSocket</code> 中多為幾個名稱設定監聽，以捕獲 Server 發送的訊息，最後在 <code class=\"hf ip iq ir is b\">return</code> 裡添加了幾個按鈕分別發送不同名稱的訊息：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">initWebSocket</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//對 getMessage 設定監聽，如果 server 有透過 getMessage 傳送訊息，將會在此被捕捉</span>\n    ws<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessage'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">message</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    ws<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessageAll'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">message</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    ws<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessageLess'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">message</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">sendMessage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    ws<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token string\">'收到訊息囉！'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string\">'button'</span> value<span class=\"token operator\">=</span><span class=\"token string\">'連線'</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>connectWebSocket<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string\">'button'</span> value<span class=\"token operator\">=</span><span class=\"token string\">'送出訊息，只有自己收到回傳'</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessage'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string\">'button'</span> value<span class=\"token operator\">=</span><span class=\"token string\">'送出訊息，讓所有人收到回傳'</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessageAll'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string\">'button'</span> value<span class=\"token operator\">=</span><span class=\"token string\">'送出訊息，除了自己外所有人收到回傳'</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getMessageLess'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>調整完兩邊的程式後，執行結果如下：</p>\n<div><img class=\"s t u hb ai\" src=\"https://miro.medium.com/max/1460/1*SCKCp3eNCR2l0sGNz4637g.gif\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>&#x900F;&#x904E;&#x4E0D;&#x540C;&#x7684;&#x767C;&#x9001;&#x65B9;&#x5F0F;&#x9054;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x7D50;&#x679C;</span>\n          </div></div><br>\n<h3>進階用法 - 分組 ( room )</h3>\n<p>分組的意思就是為 Client 設定聊天室，在遊戲裡就像「頻道」、「分流」的概念， <code class=\"hf ip iq ir is b\">socket.io</code> 能讓 Server 可以針對某個 <code class=\"hf ip iq ir is b\">room</code> 傳送訊息，也可以自由地將 Client 加入或移除某個 <code class=\"hf ip iq ir is b\">room</code> ，而在一般沒有設定 room 的狀態下，都會為每個 Client 預設一個 id 作為 <code class=\"hf ip iq ir is b\">room</code> 。</p>\n<h3>Client</h3>\n<p>這次從 Client 開始，在程式中加上一個下拉選單讓使用者選擇房間，選擇時會送出房間名稱給 Server ，並且為 <code class=\"hf ip iq ir is b\">webSocket</code> 增加一個監聽，以接收從 Server 傳送過來的新訊息：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">initWebSocket</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  \n    <span class=\"token comment\">/*其餘程式碼省略*/</span>\n  \n    <span class=\"token comment\">//增加監聽</span>\n    ws<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'addRoom'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">message</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">//選擇聊天室時觸發，如果有選擇那就將房間 id 送給 Server</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">changeRoom</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> room <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>room <span class=\"token operator\">!==</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        ws<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'addRoom'</span><span class=\"token punctuation\">,</span> room<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token comment\">//增加下拉選單選擇房間</span>\n        <span class=\"token operator\">&lt;</span>select onChange<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>changeRoom<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>option value<span class=\"token operator\">=</span><span class=\"token string\">''</span><span class=\"token operator\">></span>請選擇房間<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>option<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>option value<span class=\"token operator\">=</span><span class=\"token string\">'room1'</span><span class=\"token operator\">></span>房間一<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>option<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>option value<span class=\"token operator\">=</span><span class=\"token string\">'room2'</span><span class=\"token operator\">></span>房間二<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>option<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>select<span class=\"token operator\">></span>\n        \n        <span class=\"token punctuation\">{</span><span class=\"token comment\">/*其餘程式碼省略*/</span><span class=\"token punctuation\">}</span>     \n\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Server</h3>\n<p>當 Server 端接收到訊息時，可以使用 <code class=\"hf ip iq ir is b\">socket.join</code> 將房間 id 加到該 Client 的 <code class=\"hf ip iq ir is b\">room</code> 物件中，並發送訊息給相同房間 id 的 Client ，而發送的訊息又有分成兩種：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">io<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'connection'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">socket</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">/*其餘程式碼省略*/</span>\n    \n    socket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'addRoom'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">room</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        socket<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>room<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">//(1)發送給在同一個 room 中除了自己外的 Client</span>\n        socket<span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>room<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'addRoom'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'已有新人加入聊天室！'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">//(2)發送給在 room 中所有的 Client</span>\n        io<span class=\"token punctuation\">.</span>sockets<span class=\"token punctuation\">.</span><span class=\"token function\">in</span><span class=\"token punctuation\">(</span>room<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'addRoom'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'已加入聊天室！'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>以下分別展示兩種傳遞的結果：</p>\n<p>發送給在同一個 <code class=\"hf ip iq ir is b\">room</code> 中除了自己外的 Client ：</p>\n<div><img class=\"s t u hb ai\" src=\"https://miro.medium.com/max/1460/1*2SLEXrfZbJkbot7m5t6c3A.gif\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>&#x767C;&#x9001;&#x7D66;&#x5728;&#x540C;&#x4E00;&#x500B; <code class=\"hf ip iq ir is b\">room</code> &#x4E2D;&#x9664;&#x4E86;&#x81EA;&#x5DF1;&#x5916;&#x7684; Client</span>\n          </div></div><br>\n<p>發送給在 room 中所有的 Client ：</p>\n<div><img class=\"s t u hb ai\" src=\"https://miro.medium.com/max/1460/1*LcsYqAEQ584FPmH7OqHAFQ.gif\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>&#x767C;&#x9001;&#x7D66;&#x5728; room &#x4E2D;&#x6240;&#x6709;&#x7684; Client</span>\n          </div></div><br>\n<p>需要注意的是如上方所說，一開始連線的時候 <code class=\"hf ip iq ir is b\">socket.io</code> 會為每個 Client 預設 id 在 <code class=\"hf ip iq ir is b\">room</code> 裡，所以取出 <code class=\"hf ip iq ir is b\">room</code> 的時候不會只有 <code class=\"hf ip iq ir is b\">socket.join</code> 進去的房間 id ，還會有預設的 id ，因此下方的程式將對 <code class=\"hf ip iq ir is b\">room</code> 物件所有的 <code class=\"hf ip iq ir is b\">key</code> 做迴圈，取出原本 id 以外的值就是另外 <code class=\"hf ip iq ir is b\">socket.join</code> 的房間 id 了：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//取得 rooms 物件，包含了預設 id 及另外 join 的資料</span>\n<span class=\"token keyword\">const</span> rooms <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">.</span>rooms\n\n<span class=\"token comment\">//將值取出來，尋找預設 id 外的值就能取到 join 的 id</span>\n<span class=\"token keyword\">let</span> room <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>rooms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">room</span> <span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> room <span class=\"token operator\">!==</span> socket<span class=\"token punctuation\">.</span>id\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>另外再補充 <code class=\"hf ip iq ir is b\">socket.join</code> 是非同步的事件，因此如果要在確定 <code class=\"hf ip iq ir is b\">join</code> 後再執行某些事得這麼做：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">socket<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>room<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//do something...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>最後，當 Client 更換或離開聊天室時，得使用 <code class=\"hf ip iq ir is b\">socket.leave</code> 移除在 <code class=\"hf ip iq ir is b\">socket.rooms</code> 的 id ：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">socket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'addRoom'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">room</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//加入前檢查是否已有所在房間</span>\n    <span class=\"token keyword\">const</span> nowRoom <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span>rooms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">room</span> <span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> room <span class=\"token operator\">!==</span> socket<span class=\"token punctuation\">.</span>id\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">//有的話要先離開</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>nowRoom<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        socket<span class=\"token punctuation\">.</span><span class=\"token function\">leave</span><span class=\"token punctuation\">(</span>nowFoom<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">//再加入新的</span>\n    socket<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>room<span class=\"token punctuation\">)</span>\n    io<span class=\"token punctuation\">.</span>sockets<span class=\"token punctuation\">.</span><span class=\"token function\">in</span><span class=\"token punctuation\">(</span>room<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'addRoom'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'已有新人加入聊天室！'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>中斷連線</h3>\n<p>當 Client 要與 Server 中斷連線時，可以在 Client 端使用 <code class=\"hf ip iq ir is b\">.close()</code> 這個函式，中斷後會觸發在 Server 端的 <code class=\"hf ip iq ir is b\">disconnect</code> 這個名稱的事件，但是中斷後便無法再透過此連結送出訊息到其他 Client 通知「某使用者已離開」，因此下方先透過送出一個訊息到 Server ，等通知完其他 Client 後，再送訊息到提出中斷連線的 Client 執行 <code class=\"hf ip iq ir is b\">.close()</code> ，以下實作：</p>\n<h3>Server</h3>\n<p>以 <code class=\"hf ip iq ir is b\">disConnection</code> 監聽申請中斷的事件，再以 <code class=\"hf ip iq ir is b\">leaveRoom</code> 通知 <code class=\"hf ip iq ir is b\">room</code> 裡的所有 Client 及 <code class=\"hf ip iq ir is b\">disConnection</code> 向提出中斷的 Client 送出訊息請它做 <code class=\"hf ip iq ir is b\">.close()</code> ：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">io<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'connection'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">socket</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token comment\">/*其餘程式碼省略*/</span>\n\n    <span class=\"token comment\">//送出中斷申請時先觸發此事件</span>\n    socket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'disConnection'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">message</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> room <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span>rooms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">room</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> room <span class=\"token operator\">!==</span> socket<span class=\"token punctuation\">.</span>id\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">//先通知同一 room 的其他 Client</span>\n        socket<span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>room<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'leaveRoom'</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>message<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> 已離開聊天！</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">//再送訊息讓 Client 做 .close()</span>\n        socket<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'disConnection'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">//中斷後觸發此監聽</span>\n    socket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'disconnect'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'disconnection'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Client</h3>\n<p>新增一個「斷線」的按鈕觸發 <code class=\"hf ip iq ir is b\">disConnectWebSocket</code> ，讓它送訊息給 Server 告知要斷線， <code class=\"hf ip iq ir is b\">leaveRoom</code> 及 <code class=\"hf ip iq ir is b\">disConnection</code> 分別用來接收某個 Client 離開的通知及通知完後關閉連線：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">disConnectWebSocket</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//向 Server 送出申請中斷的訊息，讓它通知其他 Client</span>\n    ws<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'disConnection'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'XXX'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">initWebSocket</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">/*其餘程式碼省略*/</span>\n  \n    <span class=\"token comment\">//以 leaveRoom 接收有使用者離開聊天的訊息</span>\n    ws<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'leaveRoom'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">message</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// Server 通知完後再傳送 disConnection 通知關閉連線</span>\n    ws<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'disConnection'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        ws<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token punctuation\">{</span><span class=\"token comment\">/*其餘省略*/</span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string\">'button'</span> value<span class=\"token operator\">=</span><span class=\"token string\">'斷線'</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>disConnectWebSocket<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token punctuation\">{</span><span class=\"token comment\">/*其餘省略*/</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>執行結果如下：</p>\n<div><img class=\"s t u hb ai\" src=\"https://miro.medium.com/max/1460/1*VSJkaD7JHrO_IfnCX5o8nw.gif\" role=\"presentation\"><div style=\"display:flex; justify-content:center; font-size: 12px\">\n            <span>&#x4E2D;&#x65B7;&#x9023;&#x7DDA;&#x5F8C;&#x4FBF;&#x7121;&#x6CD5;&#x518D;&#x8207; Server &#x6E9D;&#x901A;</span>\n          </div></div><br>\n<hr>\n<p>本文不知不覺就打了有點多，提到了 <code class=\"hf ip iq ir is b\">socket.io</code> 的基本用法、群發、聊天室，這些都是在實務上都滿有機會會碰到的技術，也搭配了 <code class=\"hf ip iq ir is b\">React</code> 做使用，希望這篇文章能夠讓各位對 <code class=\"hf ip iq ir is b\">socket.io</code> 或搭配 <code class=\"hf ip iq ir is b\">React</code> 時的使用方式有些概念。</p>\n<p>如果文章中有任何問題，或是不理解的地方，都可以留言告訴我！謝謝大家！</p>\n<p>參考文章</p>\n<ol>\n<li id=\"7fe4\" class=\"ib ic ea ar id b ie it ig iu ii iv ik iw im ix io ki kj kk\"><a href=\"https://socket.io/docs/server-api/\" class=\"cx ga iy iz ja jb\" target=\"_blank\" rel=\"noopener nofollow\">https://socket.io/docs/server-api/</a></li><li id=\"ca63\" class=\"ib ic ea ar id b ie kl ig km ii kn ik ko im kp io ki kj kk\"><a href=\"https://socket.io/docs/client-api/#socket-connected\" class=\"cx ga iy iz ja jb\" target=\"_blank\" rel=\"noopener nofollow\">https://socket.io/docs/client-api/#socket-connected</a></li>\n</ol>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"前言"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"這次的標題有點複雜和騙人，文章內主要是在 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"React"}]},{"type":"text","value":" 中搭配 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"Socket.io"}]},{"type":"text","value":" 做使用，而 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"Socket.io"}]},{"type":"text","value":" 是一個現成的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 套件，儘管它不是真正的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"webSocket"}]},{"type":"text","value":" 協定，但 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io"}]},{"type":"text","value":" 還是實現了 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"webSocket"}]},{"type":"text","value":" 及增加許多方便的功能。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果還不了解 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 的讀者，可以先參考「"},{"type":"element","tagName":"a","properties":{"className":["cx","ga","iy","iz","ja","jb"],"target":"_blank","rel":["noopener"],"href":"http://localhost:8000/js-websocket/"},"children":[{"type":"text","value":"JavaScript | WebSocket 讓前後端沒有距離"}]},{"type":"text","value":"」文章內解說的原生使用方式，當然也能直接選擇學習 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"Socket.io"}]},{"type":"text","value":" 就好，但文中的例子都會以 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"React"}]},{"type":"text","value":" 的"},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"Function Component"}]},{"type":"text","value":" 配合 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"Hooks"}]},{"type":"text","value":" 撰寫，就不再另外列舉在一般 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"HTML"}]},{"type":"text","value":" 的用法。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"另外， Server 方面會以 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"Node.js"}]},{"type":"text","value":" 建置，還沒碰過 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"Node.js"}]},{"type":"text","value":" 的話也能參考「"},{"type":"element","tagName":"a","properties":{"href":"https://ithelp.ithome.com.tw/articles/10199058","className":["cx","ga","iy","iz","ja","jb"],"target":"_blank","rel":["noopener","nofollow"]},"children":[{"type":"text","value":"[筆記][node.js]第一次建置node.js開發環境和安裝npm就上手！"}]},{"type":"text","value":"」建置環境，有任何問題再麻煩留言告訴我，謝謝！"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Socket.io"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io"}]},{"type":"text","value":" 分成兩個主要的部分，一個是負責在 Server 端啟動 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 服務的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io"}]},{"type":"text","value":" 和在 Client 端做連結處理的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io-client"}]},{"type":"text","value":" ，因此使用時便不需要再尋找 Server 及 Client 各需要哪些套件，一切都交給 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io"}]},{"type":"text","value":" 就行了。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"基本溝通方式解說"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"下方會先從建立 Server 的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io"}]},{"type":"text","value":" 開始敘述，再解釋兩邊的互動方式。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Server"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"以 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"npm init"}]},{"type":"text","value":" 建立一個專案後，透過下列指令安裝 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"express"}]},{"type":"text","value":" 和 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io"}]},{"type":"text","value":" ："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"span","properties":{"id":"b296","className":["jq","hr","ea","ar","is","b","fd","ke","kf","r","kg"]},"children":[{"type":"text","value":"npm install express"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"npm install socket.io"}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"安裝完後在專案內建立一個 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"server.js"}]},{"type":"text","value":" ，用來做專案的進入點運行 Server："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" express "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"require"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'express'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" app "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"express"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//將 express 放進 http 中開啟 Server 的 3000 port ，正確開啟後會在 console 中印出訊息"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" server "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"require"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'http'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"Server"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"app"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"listen"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3000"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'open server!'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//將啟動的 Server 送給 socket.io 處理"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" io "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"require"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'socket.io'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"server"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"/*上方為此寫法的簡寫：\n  const socket = require('socket.io')\n  const io = socket(server)\n*/"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//監聽 Server 連線後的所有事件，並捕捉事件 socket 執行"}]},{"type":"text","value":"\nio"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'connection'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"socket"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//經過連線後在 console 中印出訊息"}]},{"type":"text","value":"\n    console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'success connect!'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//監聽透過 connection 傳進來的事件"}]},{"type":"text","value":"\n    socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessage'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"message"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//回傳 message 給發送訊息的 Client"}]},{"type":"text","value":"\n        socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"emit"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessage'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" message"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"server.js"}]},{"type":"text","value":" 內有幾點需要注意的地方："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"id":"6525","className":["ib","ic","ea","ar","id","b","ie","it","ig","iu","ii","iv","ik","iw","im","ix","io","ki","kj","kk"]},"children":[{"type":"text","value":"如果是使用 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io"}]},{"type":"text","value":" 套件，因為它不是真正的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"webSocket"}]},{"type":"text","value":" 協定，所以還是得使用 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"http"}]},{"type":"text","value":" 啟動 Server ，再把 Server 物件送給 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io"}]},{"type":"text","value":" ，處理過後會得到一個物件 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"io"}]},{"type":"text","value":" ，可以用它的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"on"}]},{"type":"text","value":" 監聽開啟連線後的設定。"}]},{"type":"element","tagName":"li","properties":{"id":"9a62","className":["ib","ic","ea","ar","id","b","ie","kl","ig","km","ii","kn","ik","ko","im","kp","io","ki","kj","kk"]},"children":[{"type":"text","value":"如果 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"io"}]},{"type":"text","value":" 監聽到有訊息從 Client 傳到 Server 時，會將捕捉到的事件內容 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket"}]},{"type":"text","value":" 物件傳至 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"connection"}]},{"type":"text","value":" 後的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"function"}]},{"type":"text","value":" 中。"}]},{"type":"element","tagName":"li","properties":{"id":"a0d3","className":["ib","ic","ea","ar","id","b","ie","kl","ig","km","ii","kn","ik","ko","im","kp","io","ki","kj","kk"]},"children":[{"type":"text","value":"被傳入 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"connection"}]},{"type":"text","value":" 中的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket"}]},{"type":"text","value":" 也可以自訂監聽 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"message"}]},{"type":"text","value":" 的類型，例如上方的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"getMessage"}]},{"type":"text","value":" 就是筆者自行設定的類型名稱， "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io"}]},{"type":"text","value":" 只會觸發對應的監聽 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"Function"}]},{"type":"text","value":"。"}]},{"type":"element","tagName":"li","properties":{"id":"f844","className":["ib","ic","ea","ar","id","b","ie","kl","ig","km","ii","kn","ik","ko","im","kp","io","ki","kj","kk"]},"children":[{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.emit"}]},{"type":"text","value":" 為回覆訊息給 Client 的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"Function"}]},{"type":"text","value":" ，它第一個參數為訊息類型，這個和 Server 的監聽名稱一樣，在 Client 端也只有設定監聽類型為 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"getMessage"}]},{"type":"text","value":" 的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"Function"}]},{"type":"text","value":" 才會觸發，而第二個為訊息內容。"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果上方有不了解的部分，可以先大略看過，配合 Client 的運作一起看會更清楚。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"完成 Server 的部分後可以先輸入以下指令運行："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"span","properties":{"id":"0cc1","className":["jq","hr","ea","ar","is","b","fd","ke","kf","r","kg"]},"children":[{"type":"text","value":"node server.js //server.js 為檔名"}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果程式沒有問題，那應該會在運行後出現 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"open server!"}]},{"type":"text","value":"："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["s","t","u","hb","ai"],"src":"https://miro.medium.com/max/1896/1*d8HW5xzPhctTK9EDDJIT-g.png","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"在 3000 port 上執行 server"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Client"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Client 端另外開一個專案， "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"React"}]},{"type":"text","value":" 的環境就不再另外講解，可以參考「"},{"type":"element","tagName":"a","properties":{"href":"https://ithelp.ithome.com.tw/articles/10200329","className":["cx","ga","iy","iz","ja","jb"],"target":"_blank","rel":["noopener","nofollow"]},"children":[{"type":"text","value":"webpack&React開發環境篇(1)"}]},{"type":"text","value":"」和「"},{"type":"element","tagName":"a","properties":{"href":"https://ithelp.ithome.com.tw/articles/10200459","className":["cx","ga","iy","iz","ja","jb"],"target":"_blank","rel":["noopener","nofollow"]},"children":[{"type":"text","value":"webpack&React開發環境篇(2)"}]},{"type":"text","value":"」上下兩篇搭建，那除了 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"React"}]},{"type":"text","value":" 的部分還需要下載 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io-client"}]},{"type":"text","value":" ："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"span","properties":{"id":"120a","className":["jq","hr","ea","ar","is","b","fd","ke","kf","r","kg"]},"children":[{"type":"text","value":"npm install socket.io-client"}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"下載後，就能開始實做一個連結 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"webSocket"}]},{"type":"text","value":" 並能夠發送及接收訊息的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"component"}]},{"type":"text","value":" ："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" React"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" useState"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" useEffect "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"from"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'react'"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" ReactDom "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"from"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'react-dom'"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" webSocket "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"from"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'socket.io-client'"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"Main"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"setWs"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"useState"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"null"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"connectWebSocket"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//開啟"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setWs"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"webSocket"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'http://localhost:3000'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"useEffect"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//連線成功在 console 中打印訊息"}]},{"type":"text","value":"\n            console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'success connect!'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//設定監聽"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"initWebSocket"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"initWebSocket"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//對 getMessage 設定監聽，如果 server 有透過 getMessage 傳送訊息，將會在此被捕捉"}]},{"type":"text","value":"\n        ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessage'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"message"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n            console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"message"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"sendMessage"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//以 emit 送訊息，並以 getMessage 為名稱送給 server 捕捉"}]},{"type":"text","value":"\n        ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"emit"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessage'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'只回傳給發送訊息的 client'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"div"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"input type"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'button'"}]},{"type":"text","value":" value"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'連線'"}]},{"type":"text","value":" onClick"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"connectWebSocket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"input type"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'button'"}]},{"type":"text","value":" value"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'送出訊息'"}]},{"type":"text","value":" onClick"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"sendMessage"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"text","value":"div"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\nReactDom"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"render"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"Main "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" document"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getElementById"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'root'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"關於此 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"component"}]},{"type":"text","value":" 的架構可以分為幾下幾塊："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"id":"87f2","className":["ib","ic","ea","ar","id","b","ie","it","ig","iu","ii","iv","ik","iw","im","ix","io","ki","kj","kk"]},"children":[{"type":"text","value":"使用 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"useState"}]},{"type":"text","value":" 在 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"component"}]},{"type":"text","value":" 內建立一個 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"state"}]},{"type":"text","value":" "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"ws"}]},{"type":"text","value":" ，當使用者點擊「連線」按鈕時觸發 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"connectWebSocket"}]},{"type":"text","value":" ，觸發後透過從 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io-client"}]},{"type":"text","value":" 套件中 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" 的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"webSocket"}]},{"type":"text","value":" 連線至剛剛執行 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"server.js"}]},{"type":"text","value":" 的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"http://localhost:3000"}]},{"type":"text","value":" ，最後 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"webSocket"}]},{"type":"text","value":" 連線成功後會藉由 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"setWs"}]},{"type":"text","value":" 將 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 物件寫到 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"ws"}]},{"type":"text","value":" 。"}]},{"type":"element","tagName":"li","properties":{"id":"6abb","className":["ib","ic","ea","ar","id","b","ie","kl","ig","km","ii","kn","ik","ko","im","kp","io","ki","kj","kk"]},"children":[{"type":"text","value":"連線後 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"component"}]},{"type":"text","value":" 的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"state"}]},{"type":"text","value":" "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"ws"}]},{"type":"text","value":" 就會改變，生命週期 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"useEffect"}]},{"type":"text","value":" 也會被觸發，觸發時先判斷 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"ws"}]},{"type":"text","value":" 內是否真的有值，因為 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"useEffect"}]},{"type":"text","value":" 在組件第一次 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"render"}]},{"type":"text","value":" 時就會先執行，但那時候 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"ws"}]},{"type":"text","value":" 還沒有連線所以是 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"null"}]},{"type":"text","value":" ，這時候還去執行 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"initWebSocket"}]},{"type":"text","value":" 就會發生錯誤，所以如果 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"ws"}]},{"type":"text","value":" 還是初始值 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"null"}]},{"type":"text","value":" 就不執行接下來的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"initWebSocket"}]},{"type":"text","value":" 。"}]},{"type":"element","tagName":"li","properties":{"id":"4b89","className":["ib","ic","ea","ar","id","b","ie","kl","ig","km","ii","kn","ik","ko","im","kp","io","ki","kj","kk"]},"children":[{"type":"text","value":"在 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"initWebSocket"}]},{"type":"text","value":" 中替 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"ws"}]},{"type":"text","value":" 增加了監聽 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"getMessage"}]},{"type":"text","value":" 的訊息，當 Server 有發送以 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"getMessage"}]},{"type":"text","value":" 為名稱的訊息，就會在這裡被捕捉到，並在第二個參數中接收訊息，將訊息內容打印到 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"console"}]},{"type":"text","value":" 中。"}]},{"type":"element","tagName":"li","properties":{"id":"9f12","className":["ib","ic","ea","ar","id","b","ie","kl","ig","km","ii","kn","ik","ko","im","kp","io","ki","kj","kk"]},"children":[{"type":"text","value":"當我按下「送出訊息」按鈕時， "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"sendMessage"}]},{"type":"text","value":" 中會以 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"ws.emit"}]},{"type":"text","value":" 送出訊息，而送出的除了訊息內容外，還有辨別他的名稱 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"getMessage"}]},{"type":"text","value":" 。"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在第一點中需要注意的是 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"ws://localhost:3000"}]},{"type":"text","value":" 是無法正確與 Server 做"},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"connection"}]},{"type":"text","value":" 的，因為 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io"}]},{"type":"text","value":" 本身是 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"http"}]},{"type":"text","value":" 協定而不是 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" ，如果要看更多協議可以參考 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/socketio/socket.io-protocol#socketio-protocol","className":["cx","ga","iy","iz","ja","jb"],"target":"_blank","rel":["noopener","nofollow"]},"children":[{"type":"text","value":"socket.io"}]}]},{"type":"element","tagName":"a","properties":{"href":"https://github.com/socketio/socket.io-protocol#socketio-protocol","className":["cx","ga","iy","iz","ja","jb"],"target":"_blank","rel":["noopener","nofollow"]},"children":[{"type":"text","value":" 的協議"}]},{"type":"text","value":"。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"看到這裡，就能夠將剛剛 Server 的程式碼拿來與 Client 一起講解兩邊溝通的流程了："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"id":"257d","className":["ib","ic","ea","ar","id","b","ie","it","ig","iu","ii","iv","ik","iw","im","ix","io","ki","kj","kk"]},"children":[{"type":"text","value":"由 Client 以 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"ws.emit('getMessage','訊息內容')"}]},{"type":"text","value":" 將訊息送到 Server。"}]},{"type":"element","tagName":"li","properties":{"id":"4b9e","className":["ib","ic","ea","ar","id","b","ie","kl","ig","km","ii","kn","ik","ko","im","kp","io","ki","kj","kk"]},"children":[{"type":"text","value":"Server 藉由 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.on('getMessage',message=>{/*執行動作*/})"}]},{"type":"text","value":" 捕捉到訊息。"}]},{"type":"element","tagName":"li","properties":{"id":"cffd","className":["ib","ic","ea","ar","id","b","ie","kl","ig","km","ii","kn","ik","ko","im","kp","io","ki","kj","kk"]},"children":[{"type":"text","value":"Server 處理完訊息內容後再透過 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.emit('getMessage','訊息內容')"}]},{"type":"text","value":" 將訊息傳給 Client 。"}]},{"type":"element","tagName":"li","properties":{"id":"ecb0","className":["ib","ic","ea","ar","id","b","ie","kl","ig","km","ii","kn","ik","ko","im","kp","io","ki","kj","kk"]},"children":[{"type":"text","value":"最後 Client 會從 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"ws.on('getMessage',message=>{/*執行動作*/})"}]},{"type":"text","value":" 的監聽取得 Server 傳來的訊息。"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"上面的過程都是以 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"getMessage"}]},{"type":"text","value":" 為該訊息取名字去送出及監聽捕捉，因此就不會像原生的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" ，如果要為訊息做分類就還得多做判斷，當然用 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io"}]},{"type":"text","value":" 的方便不只有這樣子而已，先看看上方程式碼的執行畫面，再講解更多有趣的地方："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["s","t","u","hb","ai"],"src":"https://miro.medium.com/max/1404/1*TY9WH2CwfJVaT_77Z-sSBg.gif","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"Server 回傳從 Client 中收到的訊息"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"進階用法 - 群發"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"就上方的例子而言，眼尖的讀者應該有發現，筆者在使用 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.emit()"}]},{"type":"text","value":" 將訊息從 Server 傳給 Client 的時候，訊息內容為「只回傳給發送訊息的 client 」，這也代表這段訊息不會同時讓其他連接著該 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"WebSocket"}]},{"type":"text","value":" 的 Client 收到，那該怎麼做才能讓所有 Client 都收到訊息呢？"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"其實 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io"}]},{"type":"text","value":" 針對要發送的對象，提供了其他方式："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"/*只回傳給發送訊息的 client*/"}]},{"type":"text","value":"\nsocket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"emit"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessage'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" message"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"/*回傳給所有連結著的 client*/"}]},{"type":"text","value":"\nio"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"sockets"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"emit"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessageAll'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" message"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"/*回傳給除了發送者外所有連結著的 client*/"}]},{"type":"text","value":"\nsocket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"broadcast"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"emit"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessageLess'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" message"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"每種方式也都會固定帶著一個名稱被 Client 端監聽接收，如果沒有給名稱就不會被監聽給捕捉到，以下實作呈現這三種發送訊息的方式："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Server"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在 Server 端要因應不同的名稱來判斷回傳的方式，因此為幾個不同的名稱做加入監聽："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"text","value":"io"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'connection'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"socket"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  \n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"/*只回傳給發送訊息的 client*/"}]},{"type":"text","value":"\n    socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessage'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"message"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"emit"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessage'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" message"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"/*回傳給所有連結著的 client*/"}]},{"type":"text","value":"\n    socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessageAll'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"message"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        io"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"sockets"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"emit"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessageAll'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" message"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"/*回傳給除了發送者外所有連結著的 client*/"}]},{"type":"text","value":"\n    socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessageLess'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"message"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"broadcast"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"emit"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessageLess'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" message"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n  \n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Client"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在 Client 中，下方更改了 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"sendMessage"}]},{"type":"text","value":" 的內容，在呼叫的時候傳入 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"name"}]},{"type":"text","value":" 作為發送訊息的名稱，並在 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"initWebSocket"}]},{"type":"text","value":" 中多為幾個名稱設定監聽，以捕獲 Server 發送的訊息，最後在 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" 裡添加了幾個按鈕分別發送不同名稱的訊息："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"initWebSocket"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//對 getMessage 設定監聽，如果 server 有透過 getMessage 傳送訊息，將會在此被捕捉"}]},{"type":"text","value":"\n    ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessage'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"message"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"message"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessageAll'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"message"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"message"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessageLess'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"message"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"message"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"sendMessage"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"emit"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"name"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'收到訊息囉！'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"div"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"input type"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'button'"}]},{"type":"text","value":" value"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'連線'"}]},{"type":"text","value":" onClick"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"connectWebSocket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"input type"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'button'"}]},{"type":"text","value":" value"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'送出訊息，只有自己收到回傳'"}]},{"type":"text","value":" onClick"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sendMessage"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessage'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"input type"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'button'"}]},{"type":"text","value":" value"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'送出訊息，讓所有人收到回傳'"}]},{"type":"text","value":" onClick"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sendMessage"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessageAll'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"input type"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'button'"}]},{"type":"text","value":" value"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'送出訊息，除了自己外所有人收到回傳'"}]},{"type":"text","value":" onClick"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sendMessage"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'getMessageLess'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"text","value":"div"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"調整完兩邊的程式後，執行結果如下："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["s","t","u","hb","ai"],"src":"https://miro.medium.com/max/1460/1*SCKCp3eNCR2l0sGNz4637g.gif","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"透過不同的發送方式達到不同的結果"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"進階用法 - 分組 ( room )"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"分組的意思就是為 Client 設定聊天室，在遊戲裡就像「頻道」、「分流」的概念， "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io"}]},{"type":"text","value":" 能讓 Server 可以針對某個 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"room"}]},{"type":"text","value":" 傳送訊息，也可以自由地將 Client 加入或移除某個 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"room"}]},{"type":"text","value":" ，而在一般沒有設定 room 的狀態下，都會為每個 Client 預設一個 id 作為 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"room"}]},{"type":"text","value":" 。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Client"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"這次從 Client 開始，在程式中加上一個下拉選單讓使用者選擇房間，選擇時會送出房間名稱給 Server ，並且為 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"webSocket"}]},{"type":"text","value":" 增加一個監聽，以接收從 Server 傳送過來的新訊息："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"initWebSocket"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  \n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"/*其餘程式碼省略*/"}]},{"type":"text","value":"\n  \n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//增加監聽"}]},{"type":"text","value":"\n    ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'addRoom'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"message"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"message"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//選擇聊天室時觸發，如果有選擇那就將房間 id 送給 Server"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"changeRoom"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"event"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"let"}]},{"type":"text","value":" room "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" event"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"target"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"value\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"room "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"!=="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"''"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"emit"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'addRoom'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" room"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"div"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//增加下拉選單選擇房間"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"select onChange"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"changeRoom"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"option value"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"''"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"請選擇房間"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"text","value":"option"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"option value"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'room1'"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"房間一"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"text","value":"option"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"option value"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'room2'"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"房間二"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"text","value":"option"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"text","value":"select"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n        \n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"/*其餘程式碼省略*/"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"     \n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"text","value":"div"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Server"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"當 Server 端接收到訊息時，可以使用 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.join"}]},{"type":"text","value":" 將房間 id 加到該 Client 的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"room"}]},{"type":"text","value":" 物件中，並發送訊息給相同房間 id 的 Client ，而發送的訊息又有分成兩種："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"text","value":"io"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'connection'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"socket"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"/*其餘程式碼省略*/"}]},{"type":"text","value":"\n    \n    socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'addRoom'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"room"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"join"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"room"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//(1)發送給在同一個 room 中除了自己外的 Client"}]},{"type":"text","value":"\n        socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"to"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"room"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"emit"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'addRoom'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'已有新人加入聊天室！'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//(2)發送給在 room 中所有的 Client"}]},{"type":"text","value":"\n        io"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"sockets"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"in"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"room"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"emit"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'addRoom'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'已加入聊天室！'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"以下分別展示兩種傳遞的結果："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"發送給在同一個 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"room"}]},{"type":"text","value":" 中除了自己外的 Client ："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["s","t","u","hb","ai"],"src":"https://miro.medium.com/max/1460/1*2SLEXrfZbJkbot7m5t6c3A.gif","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"發送給在同一個 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"room"}]},{"type":"text","value":" 中除了自己外的 Client"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"發送給在 room 中所有的 Client ："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["s","t","u","hb","ai"],"src":"https://miro.medium.com/max/1460/1*LcsYqAEQ584FPmH7OqHAFQ.gif","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"發送給在 room 中所有的 Client"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"需要注意的是如上方所說，一開始連線的時候 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io"}]},{"type":"text","value":" 會為每個 Client 預設 id 在 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"room"}]},{"type":"text","value":" 裡，所以取出 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"room"}]},{"type":"text","value":" 的時候不會只有 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.join"}]},{"type":"text","value":" 進去的房間 id ，還會有預設的 id ，因此下方的程式將對 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"room"}]},{"type":"text","value":" 物件所有的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"key"}]},{"type":"text","value":" 做迴圈，取出原本 id 以外的值就是另外 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.join"}]},{"type":"text","value":" 的房間 id 了："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//取得 rooms 物件，包含了預設 id 及另外 join 的資料"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" rooms "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"rooms\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//將值取出來，尋找預設 id 外的值就能取到 join 的 id"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"let"}]},{"type":"text","value":" room "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" Object"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"keys"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"rooms"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"find"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"room"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" room "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"!=="}]},{"type":"text","value":" socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"id\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"另外再補充 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.join"}]},{"type":"text","value":" 是非同步的事件，因此如果要在確定 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"join"}]},{"type":"text","value":" 後再執行某些事得這麼做："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"text","value":"socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"join"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"room"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//do something..."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"最後，當 Client 更換或離開聊天室時，得使用 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.leave"}]},{"type":"text","value":" 移除在 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.rooms"}]},{"type":"text","value":" 的 id ："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"text","value":"socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'addRoom'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"room"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//加入前檢查是否已有所在房間"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" nowRoom "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" Object"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"keys"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"rooms"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"find"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"room"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" room "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"!=="}]},{"type":"text","value":" socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"id\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//有的話要先離開"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"nowRoom"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"leave"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"nowFoom"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//再加入新的"}]},{"type":"text","value":"\n    socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"join"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"room"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    io"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"sockets"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"in"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"room"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"emit"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'addRoom'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'已有新人加入聊天室！'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"中斷連線"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"當 Client 要與 Server 中斷連線時，可以在 Client 端使用 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":".close()"}]},{"type":"text","value":" 這個函式，中斷後會觸發在 Server 端的 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"disconnect"}]},{"type":"text","value":" 這個名稱的事件，但是中斷後便無法再透過此連結送出訊息到其他 Client 通知「某使用者已離開」，因此下方先透過送出一個訊息到 Server ，等通知完其他 Client 後，再送訊息到提出中斷連線的 Client 執行 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":".close()"}]},{"type":"text","value":" ，以下實作："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Server"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"以 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"disConnection"}]},{"type":"text","value":" 監聽申請中斷的事件，再以 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"leaveRoom"}]},{"type":"text","value":" 通知 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"room"}]},{"type":"text","value":" 裡的所有 Client 及 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"disConnection"}]},{"type":"text","value":" 向提出中斷的 Client 送出訊息請它做 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":".close()"}]},{"type":"text","value":" ："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"text","value":"io"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'connection'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"socket"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    \n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"/*其餘程式碼省略*/"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//送出中斷申請時先觸發此事件"}]},{"type":"text","value":"\n    socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'disConnection'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"message"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" room "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" Object"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"keys"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"rooms"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"find"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"room"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" room "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"!=="}]},{"type":"text","value":" socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"id\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//先通知同一 room 的其他 Client"}]},{"type":"text","value":"\n        socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"to"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"room"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"emit"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'leaveRoom'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","template-string"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","template-punctuation","string"]},"children":[{"type":"text","value":"`"}]},{"type":"element","tagName":"span","properties":{"className":["token","interpolation"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","interpolation-punctuation","punctuation"]},"children":[{"type":"text","value":"${"}]},{"type":"text","value":"message"},{"type":"element","tagName":"span","properties":{"className":["token","interpolation-punctuation","punctuation"]},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":" 已離開聊天！"}]},{"type":"element","tagName":"span","properties":{"className":["token","template-punctuation","string"]},"children":[{"type":"text","value":"`"}]}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//再送訊息讓 Client 做 .close()"}]},{"type":"text","value":"\n        socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"emit"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'disConnection'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"''"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//中斷後觸發此監聽"}]},{"type":"text","value":"\n    socket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'disconnect'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'disconnection'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Client"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"新增一個「斷線」的按鈕觸發 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"disConnectWebSocket"}]},{"type":"text","value":" ，讓它送訊息給 Server 告知要斷線， "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"leaveRoom"}]},{"type":"text","value":" 及 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"disConnection"}]},{"type":"text","value":" 分別用來接收某個 Client 離開的通知及通知完後關閉連線："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"disConnectWebSocket"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//向 Server 送出申請中斷的訊息，讓它通知其他 Client"}]},{"type":"text","value":"\n    ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"emit"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'disConnection'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'XXX'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"initWebSocket"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"/*其餘程式碼省略*/"}]},{"type":"text","value":"\n  \n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//以 leaveRoom 接收有使用者離開聊天的訊息"}]},{"type":"text","value":"\n    ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'leaveRoom'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter"]},"children":[{"type":"text","value":"message"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        console"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"message"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// Server 通知完後再傳送 disConnection 通知關閉連線"}]},{"type":"text","value":"\n    ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'disConnection'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        ws"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"close"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"div"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"/*其餘省略*/"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"input type"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'button'"}]},{"type":"text","value":" value"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'斷線'"}]},{"type":"text","value":" onClick"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"disConnectWebSocket"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"/*其餘省略*/"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"/"}]},{"type":"text","value":"div"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"執行結果如下："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"img","properties":{"className":["s","t","u","hb","ai"],"src":"https://miro.medium.com/max/1460/1*VSJkaD7JHrO_IfnCX5o8nw.gif","role":"presentation"},"children":[]},{"type":"element","tagName":"div","properties":{"style":"display:flex; justify-content:center; font-size: 12px"},"children":[{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{},"children":[{"type":"text","value":"中斷連線後便無法再與 Server 溝通"}]},{"type":"text","value":"\n          "}]}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"本文不知不覺就打了有點多，提到了 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io"}]},{"type":"text","value":" 的基本用法、群發、聊天室，這些都是在實務上都滿有機會會碰到的技術，也搭配了 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"React"}]},{"type":"text","value":" 做使用，希望這篇文章能夠讓各位對 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"socket.io"}]},{"type":"text","value":" 或搭配 "},{"type":"element","tagName":"code","properties":{"className":["hf","ip","iq","ir","is","b"]},"children":[{"type":"text","value":"React"}]},{"type":"text","value":" 時的使用方式有些概念。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果文章中有任何問題，或是不理解的地方，都可以留言告訴我！謝謝大家！"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"參考文章"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"id":"7fe4","className":["ib","ic","ea","ar","id","b","ie","it","ig","iu","ii","iv","ik","iw","im","ix","io","ki","kj","kk"]},"children":[{"type":"element","tagName":"a","properties":{"href":"https://socket.io/docs/server-api/","className":["cx","ga","iy","iz","ja","jb"],"target":"_blank","rel":["noopener","nofollow"]},"children":[{"type":"text","value":"https://socket.io/docs/server-api/"}]}]},{"type":"element","tagName":"li","properties":{"id":"ca63","className":["ib","ic","ea","ar","id","b","ie","kl","ig","km","ii","kn","ik","ko","im","kp","io","ki","kj","kk"]},"children":[{"type":"element","tagName":"a","properties":{"href":"https://socket.io/docs/client-api/#socket-connected","className":["cx","ga","iy","iz","ja","jb"],"target":"_blank","rel":["noopener","nofollow"]},"children":[{"type":"text","value":"https://socket.io/docs/client-api/#socket-connected"}]}]},{"type":"text","value":"\n"}]}],"data":{"quirksMode":false}},"excerpt":"前言 這次的標題有點複雜和騙人，文章內主要是在 React 中搭配 Socket.io 做使用，而 Socket.io 是一個現成的 WebSocket 套件，儘管它不是真正的 webSocket 協定，但 socket.io 還是實現了 webSocket…","timeToRead":8,"frontmatter":{"title":"React | 在 React 中使用 WebSocket - feat. Socket.io 基本教學","userDate":"8 March 2019","date":"2019-03-08T17:35:55.149Z","tags":["React"],"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAIDBf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAAByp0nIT//xAAXEAEAAwAAAAAAAAAAAAAAAAABABIg/9oACAEBAAEFAgGUM//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABkQAAEFAAAAAAAAAAAAAAAAAAEAESAhMv/aAAgBAQAGPwKyy2I//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABPyFQh//aAAwDAQACAAMAAAAQv9//xAAWEQEBAQAAAAAAAAAAAAAAAAABEFH/2gAIAQMBAT8QR2f/xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPxCn/8QAHRAAAQIHAAAAAAAAAAAAAAAAAREhACAxQVFhcf/aAAgBAQABPxCmDgHFsxwV2sv/2Q==","aspectRatio":1.828099173553719,"src":"/static/b7a8f321b0bbc07ca9b9d22a7a505ed5/97b31/React.jpg","srcSet":"/static/b7a8f321b0bbc07ca9b9d22a7a505ed5/f8f18/React.jpg 930w,\n/static/b7a8f321b0bbc07ca9b9d22a7a505ed5/0e6ff/React.jpg 1860w,\n/static/b7a8f321b0bbc07ca9b9d22a7a505ed5/97b31/React.jpg 2212w","sizes":"(max-width: 2212px) 100vw, 2212px"}}},"author":{"id":"GQSM","bio":"Enjoy life enjoy coding!","avatar":{"children":[{"__typename":"ImageSharp","fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAC4jAAAuIwF4pT92AAACIElEQVQ4y5WTz2saQRTHd3Y3/mrxV6NbsYoIUmtMDkkrXoVgvRQUVMiteLGQ/6G9KKVC0d5CG0/NxRx6kRZ6aC8JND0KOcdzKLTgyUTd6XvL2zCUVqcDX77uzLyPb96bURRhdDodyweDAVP+Mjjnlo9GI0V69Pt9RsG36/X6i1wud9xoNPZt2Hg8locNh8Ob34VC4aPD4UAK93q9vFKpvKYl1YavHNVqVUVvtVqPwuEwRl2rqnqF0Hg8/nM6nRq43u12mRQQjmgB2+32Q8MwELjQNG2BwEQicTmZTCxgr9eTA9JRrM3FYvGD0+nEiSufz8fL5XKPtmnSR7ZhMJyBQOAkk8nwbDY7S6fT3O12f4f5e3/skwa+w4RBM/I5+SHIIwtVyfegbhyaMYeszFQqZcKcqes6pwY9kz7vt7MztPM76+s8Go3OSqUSh0aZeORgMHgdCoUwy88ejycok6Wd4fNkMsmhEYtarWY2m00TwKbf7zcjkQgC69AsrKVbOtN8Pn+ENQPADDKcx2Kxucvl4ts7O29wHS58GCyxMkuokW7dC03bZ4xZ91BsCryYXYvA2BrYFshYlZxOfoAACPwF8PcC+CUoCnoA2sQXKpRq6bX5RIC3oFugL/R9tCTmnwtY7AvQJchPc/cJ+FVoIJO91Hcp+Cl9r5G/Av0Quit9sZ+AToUgMfNzaoayqnbiP25TwcUg2x+DNv7nPbMlxZYC/AYn5p1FkAm0lwAAAABJRU5ErkJggg==","width":400,"height":402,"src":"/static/bca487154c11d830750d2707c9e6d3e5/4e842/gqsm.png","srcSet":"/static/bca487154c11d830750d2707c9e6d3e5/4e842/gqsm.png 1x,\n/static/bca487154c11d830750d2707c9e6d3e5/fca9c/gqsm.png 1.5x,\n/static/bca487154c11d830750d2707c9e6d3e5/94286/gqsm.png 2x"}}]}}}},"relatedPosts":{"totalCount":11,"edges":[{"node":{"id":"8d126153-af62-564b-9803-2f7fbd2deca5","timeToRead":2,"excerpt":"Hello guys, I am Clark! In this post I am going to continue share and practice about more styled components! Styling any component When I…","frontmatter":{"title":"Start learn styled components!(3)-You can styling any component you want!"},"fields":{"slug":"/Start-learn-styled-components-You-can-styling-any-component-you-want/"}}},{"node":{"id":"0b68f40e-0dd4-52c3-b381-259b9c8296f0","timeToRead":4,"excerpt":"Hello! You guys! I am Clark today we are keep going to learn how to implementing SSR in React applications with Redux!  Last article, We are…","frontmatter":{"title":"React | Simple implementing SSR(Server-Side Rendering) in React with Redux"},"fields":{"slug":"/simple-implementing-ssr-in-react-with-redux/"}}},{"node":{"id":"eaa0651c-0df7-5a48-83cf-8823c124dc6d","timeToRead":2,"excerpt":"Hello guys, I am Clark! In this post I am going to share more about styled components I learn. If you don’t know what is styled components…","frontmatter":{"title":"Start learn styled components!(2)-Extending Styles"},"fields":{"slug":"/start-learn-styled-components-extending-styles/"}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/use-websocket-by-react-socket-io/","prev":{"excerpt":"前言 最近因為工作的關係接觸到 WebSocket ， WebSocket 是網路協定的一種， Client 可以透過此協定與 Server 做溝通，而他和一般 http 或 https 不同的是， WebSocket…","timeToRead":5,"frontmatter":{"title":"JavaScript | WebSocket 讓前後端沒有距離","tags":["JavaScript","WebSocket"],"date":"2019-02-23T13:45:54.149Z","draft":false,"image":{"childImageSharp":{"fluid":{"aspectRatio":2.1183932346723044,"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAECAwX/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQMF/9oADAMBAAIQAxAAAAHQjcZtUMR//8QAGxAAAQQDAAAAAAAAAAAAAAAAAQACAxAREjH/2gAIAQEAAQUCJdnaRDl//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGxAAAQQDAAAAAAAAAAAAAAAAAAIRICEygaH/2gAIAQEABj8CpL7MOlw//8QAGxAAAQQDAAAAAAAAAAAAAAAAEQABITEgQVH/2gAIAQEAAT8haUnYKCqkAB9th//aAAwDAQACAAMAAAAQv/8A/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFhEBAQEAAAAAAAAAAAAAAAAAARBR/9oACAECAQE/EBMn/8QAGhABAAIDAQAAAAAAAAAAAAAAAREhACAxcf/aAAgBAQABPxA8DDaFsgSyzwHMTQFKGQfdP//Z","sizes":"(max-width: 2004px) 100vw, 2004px","src":"/static/e87971a563d150dcfc0d784bf20dbb37/f04f7/JavaScript.jpg","srcSet":"/static/e87971a563d150dcfc0d784bf20dbb37/f8f18/JavaScript.jpg 930w,\n/static/e87971a563d150dcfc0d784bf20dbb37/0e6ff/JavaScript.jpg 1860w,\n/static/e87971a563d150dcfc0d784bf20dbb37/f04f7/JavaScript.jpg 2004w"}}},"author":{"id":"GQSM","bio":"Enjoy life enjoy coding!","avatar":{"children":[{"fixed":{"src":"/static/bca487154c11d830750d2707c9e6d3e5/4e842/gqsm.png"}}]}}},"fields":{"layout":"post","slug":"/js-websocket/"}},"next":{"excerpt":"前言 單元測試是進入前端工程後一直很想學的技能，主要是做過測試能讓自己的程式碼維持一定的水準，尤其在團隊開發時，更不會在上線時因為沒注意到某個細節而產生 Bug ，導致專案出現問題。 單元測試 單元測試是指為專案中每個單一行為做測試，通常專案裡的最小單位都是一個 function…","timeToRead":5,"frontmatter":{"title":"Jest | 讓 Jest 為你的 Code 做測試-基礎用法教學","tags":["Unit Testing","JavaScript","Jest"],"date":"2019-03-25T00:06:45.149Z","draft":false,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.4814814814814814,"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHk1CzAf//EABYQAQEBAAAAAAAAAAAAAAAAAAECIP/aAAgBAQABBQIFWKDH/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGBAAAgMAAAAAAAAAAAAAAAAAAAERICH/2gAIAQEABj8Cwlqv/8QAGRAAAgMBAAAAAAAAAAAAAAAAAREAIDFR/9oACAEBAAE/IVrUYiB2v//aAAwDAQACAAMAAAAQh9//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAEAAgMBAAAAAAAAAAAAAAABETEAEIFR/9oACAEBAAE/EIFTCeYVV4hHtaFKUxVtXuv/2Q==","sizes":"(max-width: 1840px) 100vw, 1840px","src":"/static/61b2001ca7ff66bffe5604dc0c52016d/5a4bd/Jest.jpg","srcSet":"/static/61b2001ca7ff66bffe5604dc0c52016d/f8f18/Jest.jpg 930w,\n/static/61b2001ca7ff66bffe5604dc0c52016d/5a4bd/Jest.jpg 1840w"}}},"author":{"id":"GQSM","bio":"Enjoy life enjoy coding!","avatar":{"children":[{"fixed":{"src":"/static/bca487154c11d830750d2707c9e6d3e5/4e842/gqsm.png"}}]}}},"fields":{"layout":"post","slug":"/jest-base-tutorial/"}},"primaryTag":"React"}}}